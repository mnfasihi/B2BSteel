<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B2BSteel | پلتفرم تخصصی قالب فلزی بتن و سوله</title>
    
    <!-- فونت و آیکون -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========== متغیرهای رنگ ========== */
        :root {
            --primary: #004586;
            --primary-dark: #002f5c;
            --accent: #E6B800;
            --bg: #F7F7F7;
            --card-bg: #FFFFFF;
            --muted: #6b7280;
            --dark: #1E1E1E;
            --text-dark: #2A2A2A;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        * {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg);
            color: var(--dark);
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            cursor: pointer;
            border: none;
            background: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.8s ease forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== ناوبری ========== */
        .navbar {
            background: var(--card-bg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: all 0.3s;
        }

        .navbar:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            background: var(--primary);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-text .slogan {
            font-size: 0.8rem;
            color: var(--accent);
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .nav-link {
            color: #4b5563;
            padding: 12px 20px;
            border-radius: 6px;
            transition: all 0.3s;
            font-size: 1.5rem;
            white-space: nowrap;
            font-weight: 500;
        }

        .nav-link:hover {
            background: #f3f4f6;
            color: var(--primary);
        }

        @media (max-width: 992px) {
            .nav-link {
                font-size: 1.3rem;
                padding: 10px 15px;
            }
        }

        /* ========== دکمه‌ها ========== */
        .btn {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--muted);
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.85rem;
        }

        /* ========== صفحه اصلی - اسلایدشو ========== */
        .hero-slideshow {
            width: 100%;
            height: 500px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .hero-slide {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .hero-slide.active {
            opacity: 1;
        }

        .hero-slide::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .hero-slide-content {
            position: relative;
            z-index: 2;
            color: white;
            text-align: center;
            top: 50%;
            transform: translateY(-50%);
        }

        .hero-slide-content h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero-slide-content p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* ========== شمارنده‌ها ========== */
        .counters {
            background: white;
            padding: 3rem 0;
            margin: 2rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .counters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .counter-item {
            text-align: center;
            padding: 1.5rem;
        }

        .counter-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .counter-label {
            font-size: 1.2rem;
            color: #4b5563;
        }

        /* ========== صفحه سوله با بکگراند محو ========== */
        #shed-page {
            position: relative;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .shed-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: url('images/slide1.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: blur(5px) brightness(0.5);
            transform: scale(1.1);
        }

        .shed-content {
            width: 70%;
            margin: 2rem auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 3rem 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ========== کارت‌های ویژگی‌ها ========== */
        .features {
            padding: 4rem 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            color: var(--primary);
            font-size: 2rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.06);
            transition: all 0.35s;
            height: 100%;
        }

        .feature-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }

        .feature-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.7rem;
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        /* ========== فرم‌های احراز هویت ========== */
        .auth-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .auth-card {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .auth-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4b5563;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-help {
            font-size: 0.85rem;
            color: var(--muted);
            margin-top: 0.25rem;
        }

        .user-type-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .user-type-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            background: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-type-btn.active {
            border-color: var(--primary);
            background: #eff6ff;
            color: var(--primary);
        }

        /* ========== استایل کارت درخواست‌ها ========== */
        .request-item {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-right: 4px solid var(--primary);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .request-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .request-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-open {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-in-progress {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #e0e7ff;
            color: #3730a3;
        }

        .request-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem 0;
            border-top: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
        }

        .request-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        /* ========== استایل پاسخ استعلام‌ها ========== */
        .bid-item {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            border-right: 3px solid var(--success);
        }

        .bid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .bid-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--success);
        }

        .rating-stars {
            display: flex;
            gap: 5px;
            direction: ltr;
        }

        .star {
            color: #ddd;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .star.active {
            color: #fbbf24;
        }

        /* ========== مودال ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--muted);
            cursor: pointer;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ========== داشبورد ========== */
        .dashboard {
            padding: 2rem 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .dashboard-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* ========== پنل ادمین ========== */
        .admin-panel {
            padding: 2rem 0;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .admin-stat-card h3 {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .admin-stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .admin-tab {
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .admin-tab:hover {
            background: #f3f4f6;
        }

        .admin-tab.active {
            background: var(--primary);
            color: white;
        }

        .request-with-bids {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .bids-container {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px dashed #e5e7eb;
        }

        /* ========== فوتر ========== */
        .footer {
            background: var(--primary-dark);
            color: #ddd;
            padding: 4rem 0;
            margin-top: 4rem;
        }

        .footer h3 {
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .footer a {
            color: #ccc;
            transition: color 0.2s;
        }

        .footer a:hover {
            color: var(--accent);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid #374151;
            color: #9ca3af;
        }
    </style>
</head>
<body>
<!-- ========== ناوبری اصلی ========== -->
<nav class="navbar">
    <div class="container nav-container">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-cubes"></i>
            </div>
            <div class="logo-text">
                <h1>B2BSteel</h1>
                <div class="slogan">اعتماد - شفافیت - سرعت</div>
            </div>
        </div>
        
        <div class="nav-links">
            <a href="#" class="nav-link" onclick="window.showPage('home')">خانه</a>
            <a href="#" class="nav-link" onclick="window.showPage('concrete-formwork')">قالب بتن</a>
            <a href="#" class="nav-link" onclick="window.showPage('shed')">سوله</a>
            <a href="#" class="nav-link" onclick="window.showPage('blog')">بلاگ</a>
            <a href="#" class="nav-link" onclick="window.showPage('terms')">قوانین</a>
            <a href="#" class="nav-link" onclick="window.showPage('guide')">راهنما</a>
            
            <div id="auth-buttons">
                <button class="btn btn-primary btn-sm" onclick="window.showPage('login')">ورود</button>
                <button class="btn btn-secondary btn-sm" onclick="window.showPage('register')">ثبت‌نام</button>
            </div>
            
            <div id="user-menu" class="hidden">
                <button class="btn btn-primary btn-sm" onclick="window.showPage('dashboard')">داشبورد</button>
                <button class="btn btn-danger btn-sm" onclick="window.logout()">خروج</button>
            </div>
            
            <div id="seller-formwork-menu" class="hidden">
                <button class="btn btn-primary btn-sm" onclick="window.showPage('seller-formwork-dashboard')">داشبورد فروشنده قالب</button>
                <button class="btn btn-danger btn-sm" onclick="window.logout()">خروج</button>
            </div>
            
            <div id="seller-shed-menu" class="hidden">
                <button class="btn btn-success btn-sm" onclick="window.showPage('seller-shed-dashboard')">داشبورد فروشنده سوله</button>
                <button class="btn btn-danger btn-sm" onclick="window.logout()">خروج</button>
            </div>
            
            <div id="admin-menu" class="hidden">
                <button class="btn btn-warning btn-sm" onclick="window.showPage('admin')">پنل ادمین</button>
                <button class="btn btn-primary btn-sm" onclick="window.showPage('dashboard')">داشبورد</button>
                <button class="btn btn-danger btn-sm" onclick="window.logout()">خروج</button>
            </div>
        </div>
    </div>
</nav>

<!-- ========== صفحات اصلی ========== -->
<main id="pages">

    <!-- صفحه اصلی با اسلایدشو ۳ عکسی از پوشه images -->
    <section id="home-page" class="page">
        <div class="hero-slideshow" onclick="window.nextSlide()">
            <div class="hero-slide active" style="background-image: url('images/slide1.jpg');">
                <div class="hero-slide-content">
                    <h2>سوله‌های صنعتی</h2>
                    <p>طراحی و اجرای سوله با استانداردهای جهانی</p>
                </div>
            </div>
            
            <div class="hero-slide" style="background-image: url('images/slide2.jpg');">
                <div class="hero-slide-content">
                    <h2>قالب فلزی بتن</h2>
                    <p>سیستم‌های مدرن قالب‌بندی برای پروژه‌های ساختمانی</p>
                </div>
            </div>
            
            <div class="hero-slide" style="background-image: url('images/slide3.jpg');">
                <div class="hero-slide-content">
                    <h2>اجرای حرفه‌ای</h2>
                    <p>با تیمی مجرب و متخصص در کنار شما هستیم</p>
                </div>
            </div>
        </div>

        <!-- شمارنده‌ها -->
        <div class="counters">
            <div class="container">
                <div class="counters-grid">
                    <div class="counter-item">
                        <div class="counter-number" id="counter-sellers">۰</div>
                        <div class="counter-label">فروشنده ثبت‌نام شده</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-number" id="counter-buyers">۰</div>
                        <div class="counter-label">خریدار ثبت‌نام شده</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-number" id="counter-transactions">۰</div>
                        <div class="counter-label">فروش نهایی شده</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ویژگی‌ها -->
        <div class="features">
            <div class="container">
                <h2 class="section-title">چرا B2BSteel؟</h2>
                <div class="features-grid">
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h3>حریم خصوصی کاملاً محفوظ</h3>
                        <p>اطلاعات هویتی فروشندگان تا زمان انتخاب نهایی مخفی می‌ماند.</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>شفافیت کامل قیمت</h3>
                        <p>مقایسه آسان پیشنهادات قیمت فروشندگان مختلف.</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <h3>ارتباط مستقیم و سریع</h3>
                        <p>بدون واسطه، ارتباط مستقیم با فروشندگان معتبر.</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>تایید هویت اعضا</h3>
                        <p>تمام اعضا پس از بررسی مدارک تایید می‌شوند.</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3>گارانتی و تضمین کیفیت</h3>
                        <p>سیستم امتیازدهی کیفیت را تضمین می‌کند.</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon">
                            <i class="fas fa-headset"></i>
                        </div>
                        <h3>پشتیبانی ۲۴ ساعته</h3>
                        <p>تیم پشتیبانی آماده پاسخگویی به سوالات شماست.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- صفحه قالب بتن -->
    <section id="concrete-formwork-page" class="page hidden">
        <div class="hero fade-in">
            <div class="container">
                <h2>بخش قالب فلزی بتن</h2>
                <p>خرید و فروش تخصصی انواع قالب فلزی بتن</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" style="padding: 12px 25px;" onclick="window.showPage('register')">
                        <i class="fas fa-user-tie"></i> من خریدار هستم
                    </button>
                    <button class="btn btn-success" style="padding: 12px 25px;" onclick="window.showPage('register')">
                        <i class="fas fa-industry"></i> من فروشنده هستم
                    </button>
                </div>
            </div>
        </div>
        
        <div class="container" style="padding: 4rem 0;">
            <div class="features-grid">
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <i class="fas fa-cube"></i>
                    </div>
                    <h3>قالب مدولار</h3>
                    <p>قالب‌بندی سریع و با کیفیت برای پروژه‌های مختلف ساختمانی</p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3>قالب دیوار و ستون</h3>
                    <p>قالب‌های مخصوص دیوار و ستون با مقاومت بالا</p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <i class="fas fa-bridge"></i>
                    </div>
                    <h3>قالب تونل و پل</h3>
                    <p>قالب‌های تخصصی برای پروژه‌های بزرگ عمرانی</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 3rem;">
                <button class="btn btn-primary" style="padding: 15px 40px; font-size: 1.2rem;" onclick="window.enterConcreteFormworkSystem()">
                    <i class="fas fa-sign-in-alt"></i> ورود به سیستم قالب بتن
                </button>
            </div>
        </div>
    </section>

    <!-- صفحه سوله با بکگراند محو -->
    <section id="shed-page" class="page hidden">
        <div class="shed-background"></div>
        
        <div class="container shed-content">
            <h2 class="section-title">بخش سوله</h2>
            <p style="color: var(--muted); text-align: center; max-width: 800px; margin: 0 auto 2rem;">
                انتخاب خدمات مورد نیاز خود در حوزه سوله
            </p>
            
            <div class="shed-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin: 3rem 0;">
                <div class="shed-option-card" style="background: white; border-radius: 10px; padding: 2.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; transition: all 0.3s;">
                    <div style="width: 70px; height: 70px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; color: white;">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">سوله نو</h3>
                    <button class="btn btn-primary" onclick="window.showPage('new-shed-request')" style="width: 100%;">
                        <i class="fas fa-file-alt"></i> پر کردن پرسشنامه سوله نو
                    </button>
                </div>
                
                <div class="shed-option-card" style="background: white; border-radius: 10px; padding: 2.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                    <div style="width: 70px; height: 70px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; color: white;">
                        <i class="fas fa-warehouse"></i>
                    </div>
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">سوله دست دوم</h3>
                    <button class="btn btn-success" onclick="window.loadSecondhandSheds()" style="width: 100%;">
                        <i class="fas fa-search"></i> مشاهده آگهی‌ها
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- صفحه درخواست سوله نو -->
    <section id="new-shed-request-page" class="page hidden">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto; padding: 2rem 0;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h1 style="color: var(--primary); margin-bottom: 0.5rem;">پرسشنامه درخواست سوله نو</h1>
                    <p style="color: var(--muted);">لطفاً اطلاعات پروژه خود را با دقت وارد کنید</p>
                </div>
                
                <form id="new-shed-form">
                    <!-- ابعاد سوله -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-ruler-combined"></i> ابعاد سوله
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="shed-length">طول سوله (متر)</label>
                                <input type="number" id="shed-length" class="form-control" required min="10" step="0.5" placeholder="مثال: 100">
                            </div>
                            <div class="form-group">
                                <label for="shed-width">عرض سوله (متر)</label>
                                <input type="number" id="shed-width" class="form-control" required min="10" step="0.5" placeholder="مثال: 30">
                            </div>
                            <div class="form-group">
                                <label for="shed-height">ارتفاع کنار سوله (متر)</label>
                                <input type="number" id="shed-height" class="form-control" required min="4" step="0.5" placeholder="مثال: 6">
                            </div>
                        </div>
                    </div>
                    
                    <!-- نقشه سازه -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;">نقشه سازه</h3>
                        <div class="form-group">
                            <label>آیا فایل نقشه سازه دارید؟</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="has-drawing" value="yes" onclick="window.toggleDrawingUpload(true)"> بله
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="has-drawing" value="no" checked onclick="window.toggleDrawingUpload(false)"> خیر
                                </label>
                            </div>
                        </div>
                        
                        <div id="drawing-upload-section" class="hidden">
                            <div class="form-group">
                                <label for="shed-drawing">آپلود فایل نقشه</label>
                                <input type="file" id="shed-drawing" class="form-control" accept=".pdf,.dwg,.jpg,.jpeg,.png">
                            </div>
                        </div>
                    </div>
                    
                    <!-- اطلاعات پروژه -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;">اطلاعات پروژه</h3>
                        <div class="form-group">
                            <label for="shed-usage">کارکرد سوله</label>
                            <textarea id="shed-usage" class="form-control" rows="3" required placeholder="برای چه منظوری نیاز دارید؟"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="shed-location">محل نصب سوله</label>
                            <input type="text" id="shed-location" class="form-control" required placeholder="استان، شهر">
                        </div>
                    </div>
                    
                    <!-- جرثقیل سقفی -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;">جرثقیل سقفی</h3>
                        <div class="form-group">
                            <label>آیا به جرثقیل سقفی نیاز دارید؟</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="needs-crane" value="yes" onclick="window.toggleCraneDetails(true)"> بله
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="needs-crane" value="no" checked onclick="window.toggleCraneDetails(false)"> خیر
                                </label>
                            </div>
                        </div>
                        
                        <div id="crane-details-section" class="hidden">
                            <div class="form-group">
                                <label for="crane-tonnage">تناژ جرثقیل (تن)</label>
                                <input type="number" id="crane-tonnage" class="form-control" min="1" max="100" step="0.5">
                            </div>
                        </div>
                    </div>
                    
                    <!-- فونداسیون -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;">فونداسیون</h3>
                        <div class="form-group">
                            <label>آیا فونداسیون آماده است؟</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="foundation" value="yes"> بله
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="foundation" value="no" checked> خیر
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- سندبلاست و رنگ -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;">سندبلاست و رنگ</h3>
                        <div class="form-group">
                            <label>آیا به سندبلاست نیاز دارید؟</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="sandblast" value="yes"> بله
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="sandblast" value="no" checked> خیر
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="paint-type">نوع رنگ</label>
                            <select id="paint-type" class="form-control" onchange="window.toggleOtherPaintType()">
                                <option value="">انتخاب کنید</option>
                                <option value="ضد زنگ">ضد زنگ</option>
                                <option value="آلکیدی">آلکیدی</option>
                                <option value="زینک ریچ">زینک ریچ</option>
                                <option value="اپوکسی">اپوکسی</option>
                                <option value="other">سایر</option>
                            </select>
                            <input type="text" id="other-paint-type" class="form-control hidden" placeholder="نوع رنگ" style="margin-top: 10px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="paint-thickness">ضخامت رنگ (میکرون)</label>
                            <input type="number" id="paint-thickness" class="form-control" value="50" min="20" max="200">
                        </div>
                    </div>
                    
                    <!-- وزن و قیمت (بخش اضافه شده) -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;">وزن و قیمت</h3>
                        <div class="form-group">
                            <label for="shed-weight">وزن سوله (تن) - در صورت اطلاع</label>
                            <input type="number" id="shed-weight" class="form-control" min="1" step="0.1" placeholder="وزن تقریبی">
                        </div>
                        <div class="form-group">
                            <label>نوع قیمت‌گذاری</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="price-type" value="estimated" checked> قیمت حدودی
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="price-type" value="exact"> قیمت دقیق
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- مسئولیت‌های خریدار (بخش اضافه شده) -->
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;">مسئولیت‌های خریدار</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="responsibility" value="steel"> تهیه آهن آلات
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="responsibility" value="bolts"> تهیه پیچ و مهره
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="responsibility" value="transport"> حمل
                            </label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                        <button type="button" class="btn btn-secondary" onclick="window.showPage('shed')">
                            <i class="fas fa-arrow-right"></i> بازگشت
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> ارسال درخواست
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- صفحه درخواست قالب بتن (جدید) -->
    <section id="new-concrete-request-page" class="page hidden">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto; padding: 2rem 0;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h1 style="color: var(--primary); margin-bottom: 0.5rem;">درخواست قالب بتن</h1>
                    <p style="color: var(--muted);">لطفاً اطلاعات مورد نیاز را وارد کنید</p>
                </div>
                
                <form id="new-concrete-form">
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div class="form-group">
                            <label for="concrete-title">عنوان درخواست</label>
                            <input type="text" id="concrete-title" class="form-control" required placeholder="مثال: قالب مدولار برای پروژه مسکونی">
                        </div>
                        
                        <div class="form-group">
                            <label for="concrete-description">توضیحات</label>
                            <textarea id="concrete-description" class="form-control" rows="4" required placeholder="جزئیات پروژه، ابعاد مورد نیاز، مشخصات فنی..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>اقلام درخواستی</label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="concrete-items" value="مدولار"> قالب مدولار
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="concrete-items" value="خاص"> قالب خاص
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="concrete-items" value="تونلفرم"> تونلفرم
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="concrete-items" value="داربست"> داربست
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="concrete-material">جنس قالب</label>
                            <select id="concrete-material" class="form-control" required>
                                <option value="">انتخاب کنید</option>
                                <option value="ورق رویه فولاد مبارکه">ورق رویه فولاد مبارکه</option>
                                <option value="ورق رویه و تسمه فولاد مبارکه">ورق رویه و تسمه فولاد مبارکه</option>
                                <option value="سایر">سایر</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="concrete-location">محل اجرا</label>
                            <input type="text" id="concrete-location" class="form-control" required placeholder="استان، شهر">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button type="button" class="btn btn-secondary" onclick="window.showPage('dashboard')">بازگشت</button>
                        <button type="submit" class="btn btn-primary">ثبت درخواست</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- صفحه قوانین و شرایط -->
    <section id="terms-page" class="page hidden">
        <div class="container" style="max-width: 900px; margin: 0 auto; padding: 3rem 0;">
            <div style="background: white; border-radius: 10px; padding: 2.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h1 class="section-title">قوانین و شرایط استفاده از B2BSteel</h1>
                <!-- محتوای قوانین ثابت است -->
            </div>
        </div>
    </section>

    <!-- صفحه راهنما -->
    <section id="guide-page" class="page hidden">
        <div class="container" style="padding: 4rem 0;">
            <h2 class="section-title">راهنمای استفاده از B2BSteel</h2>
            <!-- محتوای راهنما ثابت است -->
        </div>
    </section>

    <!-- صفحه بلاگ -->
    <section id="blog-page" class="page hidden">
        <div class="container" style="padding: 4rem 0;">
            <h2 class="section-title">مقالات و اخبار</h2>
            <!-- محتوای بلاگ ثابت است -->
        </div>
    </section>

    <!-- صفحه ثبت‌نام -->
    <section id="register-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">ثبت‌نام در B2BSteel</h2>
                
                <div class="user-type-selector" id="user-type-main-selector">
                    <div class="user-type-btn active" data-type="buyer" onclick="window.selectUserType('buyer')">
                        <i class="fas fa-user-tie"></i> خریدار
                    </div>
                    <div class="user-type-btn" data-type="seller" onclick="window.selectUserType('seller')">
                        <i class="fas fa-industry"></i> فروشنده
                    </div>
                </div>
                
                <div class="form-group">
                    <label>نوع کاربر</label>
                    <div class="user-type-selector" id="user-legal-type-selector">
                        <div class="user-type-btn" data-type="individual" onclick="window.selectUserLegalType('individual')">
                            <i class="fas fa-user"></i> حقیقی
                        </div>
                        <div class="user-type-btn active" data-type="company" onclick="window.selectUserLegalType('company')">
                            <i class="fas fa-building"></i> حقوقی
                        </div>
                    </div>
                </div>
                
                <div id="seller-type-section" class="form-group hidden">
                    <label>نوع فروشنده</label>
                    <div class="user-type-selector" id="seller-type-selector">
                        <div class="user-type-btn active" data-type="formwork" onclick="window.selectSellerType('formwork')">
                            <i class="fas fa-cubes"></i> قالب بتن
                        </div>
                        <div class="user-type-btn" data-type="shed" onclick="window.selectSellerType('shed')">
                            <i class="fas fa-warehouse"></i> سوله
                        </div>
                    </div>
                </div>
                
                <form id="register-form">
                    <div class="form-group">
                        <label for="reg-email">ایمیل</label>
                        <input type="email" id="reg-email" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="reg-password">رمز عبور</label>
                        <input type="password" id="reg-password" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="reg-password-confirm">تکرار رمز</label>
                        <input type="password" id="reg-password-confirm" class="form-control" required>
                    </div>
                    
                    <div id="company-fields">
                        <div class="form-group">
                            <label for="reg-company" id="company-label">نام شرکت</label>
                            <input type="text" id="reg-company" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="reg-position">سمت</label>
                            <input type="text" id="reg-position" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reg-contact">نام رابط</label>
                        <input type="text" id="reg-contact" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="reg-phone">تلفن تماس</label>
                        <input type="tel" id="reg-phone" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: flex-start; gap: 10px;">
                            <input type="checkbox" id="accept-terms" required>
                            <span>قوانین را می‌پذیرم</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">ثبت‌نام</button>
                </form>
            </div>
        </div>
    </section>

    <!-- صفحه ورود -->
    <section id="login-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">ورود به حساب</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">ایمیل</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">رمز عبور</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">ورود</button>
                </form>
            </div>
        </div>
    </section>

    <!-- صفحه فراموشی رمز -->
    <section id="forgot-password-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">بازیابی رمز عبور</h2>
                <form id="forgot-password-form">
                    <div class="form-group">
                        <label for="reset-email">ایمیل</label>
                        <input type="email" id="reset-email" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">ارسال لینک</button>
                </form>
            </div>
        </div>
    </section>

    <!-- صفحه داشبورد خریدار -->
    <section id="dashboard-page" class="page hidden">
        <div class="container dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">?</div>
                    <div>
                        <h2 id="user-name">کاربر عزیز</h2>
                        <p id="user-type">نوع حساب: خریدار</p>
                    </div>
                </div>
                <div id="buyer-actions" style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="window.showNewConcreteRequest()">
                        <i class="fas fa-plus"></i> درخواست قالب بتن
                    </button>
                    <button class="btn btn-success" onclick="window.showNewShedRequestModal()">
                        <i class="fas fa-warehouse"></i> درخواست سوله
                    </button>
                </div>
            </div>
            
            <div class="stats-grid" id="dashboard-stats"></div>
            
            <div class="dashboard-actions">
                <button class="btn btn-primary" onclick="window.loadMyRequests('all')">
                    <i class="fas fa-list"></i> همه درخواست‌ها
                </button>
                <button class="btn btn-info" onclick="window.loadMyRequests('concrete')">
                    <i class="fas fa-cubes"></i> درخواست‌های قالب
                </button>
                <button class="btn btn-info" onclick="window.loadMyRequests('shed')">
                    <i class="fas fa-warehouse"></i> درخواست‌های سوله
                </button>
            </div>
            
            <div id="dashboard-content">
                <div class="requests-list" id="buyer-requests-container">
                    <p style="text-align: center; color: var(--muted);">درخواستی یافت نشد</p>
                </div>
            </div>
        </div>
    </section>

    <!-- صفحه داشبورد فروشنده قالب -->
    <section id="seller-formwork-dashboard-page" class="page hidden">
        <div class="container dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <div class="user-avatar">🏗️</div>
                    <div>
                        <h2>داشبورد فروشنده قالب</h2>
                        <p id="seller-formwork-name">در حال بارگذاری...</p>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="window.logout()">خروج</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>پیشنهادات ارسالی</h3>
                    <div class="value" id="formwork-bids-count">۰</div>
                </div>
                <div class="stat-card">
                    <h3>پیشنهادات منتخب</h3>
                    <div class="value" id="formwork-selected-count">۰</div>
                </div>
                <div class="stat-card">
                    <h3>امتیاز شما</h3>
                    <div class="value" id="formwork-rating">۰</div>
                </div>
            </div>
            
            <div style="margin-top: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">درخواست‌های جدید قالب</h3>
                <div id="seller-formwork-requests" class="requests-list">
                    <p style="text-align: center; color: var(--muted);">در حال بارگذاری...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- صفحه داشبورد فروشنده سوله -->
    <section id="seller-shed-dashboard-page" class="page hidden">
        <div class="container dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <div class="user-avatar">🏭</div>
                    <div>
                        <h2>داشبورد فروشنده سوله</h2>
                        <p id="seller-shed-name">در حال بارگذاری...</p>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="window.logout()">خروج</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>پیشنهادات ارسالی</h3>
                    <div class="value" id="shed-bids-count">۰</div>
                </div>
                <div class="stat-card">
                    <h3>پیشنهادات منتخب</h3>
                    <div class="value" id="shed-selected-count">۰</div>
                </div>
                <div class="stat-card">
                    <h3>امتیاز شما</h3>
                    <div class="value" id="shed-rating">۰</div>
                </div>
            </div>
            
            <div style="margin-top: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">درخواست‌های جدید سوله</h3>
                <div id="seller-shed-requests" class="requests-list">
                    <p style="text-align: center; color: var(--muted);">در حال بارگذاری...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- صفحه پنل ادمین -->
    <section id="admin-page" class="page hidden">
        <div class="container admin-panel">
            <h2 class="section-title">پنل مدیریت</h2>
            
            <div class="admin-stats">
                <div class="admin-stat-card">
                    <h3>کل کاربران</h3>
                    <div class="value" id="admin-total-users">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>خریداران</h3>
                    <div class="value" id="admin-total-buyers">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>فروشندگان قالب</h3>
                    <div class="value" id="admin-formwork-sellers">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>فروشندگان سوله</h3>
                    <div class="value" id="admin-shed-sellers">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>درخواست‌های قالب</h3>
                    <div class="value" id="admin-concrete-requests">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>درخواست‌های سوله</h3>
                    <div class="value" id="admin-shed-requests">۰</div>
                </div>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="window.loadAdminTab('users')">مدیریت کاربران</button>
                <button class="admin-tab" onclick="window.loadAdminTab('concrete-requests')">درخواست‌های قالب بتن</button>
                <button class="admin-tab" onclick="window.loadAdminTab('shed-requests')">درخواست‌های سوله</button>
                <button class="admin-tab" onclick="window.loadAdminTab('transactions')">مشاهده تراکنش‌ها</button>
            </div>
            
            <div id="admin-content"></div>
        </div>
    </section>

    <!-- مودال ارسال پیشنهاد قالب -->
    <div id="submit-formwork-bid-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ارسال پیشنهاد قیمت قالب بتن</h3>
                <button class="close-modal" onclick="window.closeModal('submit-formwork-bid-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: #eff6ff; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                    <strong>پروژه:</strong> <span id="bid-project-title"></span><br>
                    <strong>مشخصات:</strong> <span id="bid-project-details"></span>
                </div>
                
                <form id="submit-formwork-bid-form">
                    <input type="hidden" id="bid-request-id">
                    
                    <div class="form-group">
                        <label>قیمت پایه (ریال)</label>
                        <input type="text" id="bid-base-price" class="form-control" required oninput="window.formatPriceInput(this)">
                    </div>
                    
                    <div class="form-group">
                        <label>درصد ارزش افزوده</label>
                        <select id="bid-vat" class="form-control" onchange="window.calculateFormworkTotal()">
                            <option value="9">۹٪</option>
                            <option value="10">۱۰٪</option>
                            <option value="15" selected>۱۵٪</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>درصد بارگیری</label>
                        <select id="bid-loading" class="form-control" onchange="window.calculateFormworkTotal()">
                            <option value="1">۱٪</option>
                            <option value="2" selected>۲٪</option>
                            <option value="3">۳٪</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>زمان تحویل (روز)</label>
                        <input type="number" id="bid-delivery" class="form-control" value="30" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label>گارانتی (ماه)</label>
                        <input type="number" id="bid-warranty" class="form-control" value="12" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>توضیحات</label>
                        <textarea id="bid-notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="price-breakdown" style="background: #f8fafc; padding: 15px; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>قیمت پایه:</span>
                            <span id="display-base-price">۰ ریال</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>ارزش افزوده:</span>
                            <span id="display-vat">۰ ریال</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>بارگیری:</span>
                            <span id="display-loading">۰ ریال</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: bold; color: var(--primary); border-top: 2px solid var(--primary); padding-top: 10px;">
                            <span>قیمت کل:</span>
                            <span id="display-total">۰ ریال</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeModal('submit-formwork-bid-modal')">انصراف</button>
                <button class="btn btn-primary" onclick="window.submitFormworkBid()">ارسال پیشنهاد</button>
            </div>
        </div>
    </div>

    <!-- مودال ارسال پیشنهاد سوله -->
    <div id="submit-shed-bid-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ارسال پیشنهاد قیمت سوله</h3>
                <button class="close-modal" onclick="window.closeModal('submit-shed-bid-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: #eff6ff; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                    <strong>پروژه:</strong> <span id="shed-bid-project-title"></span><br>
                    <strong>ابعاد:</strong> <span id="shed-bid-dimensions"></span>
                </div>
                
                <form id="submit-shed-bid-form">
                    <input type="hidden" id="shed-bid-request-id">
                    
                    <div class="form-group">
                        <label>قیمت پیشنهادی (ریال)</label>
                        <input type="text" id="shed-bid-price" class="form-control" required oninput="window.formatPriceInput(this)">
                    </div>
                    
                    <div class="form-group">
                        <label>وزن اسکلت (تن)</label>
                        <input type="number" id="shed-bid-weight" class="form-control" required step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>زمان ساخت (روز)</label>
                        <input type="number" id="shed-bid-construction-time" class="form-control" required value="45" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label>زمان نصب (روز)</label>
                        <input type="number" id="shed-bid-installation-time" class="form-control" required value="30" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label>گارانتی (ماه)</label>
                        <input type="number" id="shed-bid-warranty" class="form-control" value="12" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>توضیحات</label>
                        <textarea id="shed-bid-notes" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeModal('submit-shed-bid-modal')">انصراف</button>
                <button class="btn btn-primary" onclick="window.submitShedBid()">ارسال پیشنهاد</button>
            </div>
        </div>
    </div>

    <!-- مودال امتیاز دهی -->
    <div id="rating-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>امتیاز دهی به فروشنده</h3>
                <button class="close-modal" onclick="window.closeModal('rating-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <p id="rating-seller-info"></p>
                </div>
                
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="rating-stars" style="justify-content: center; font-size: 2rem;">
                        <i class="far fa-star star" data-rating="1" onclick="window.setRating(1)"></i>
                        <i class="far fa-star star" data-rating="2" onclick="window.setRating(2)"></i>
                        <i class="far fa-star star" data-rating="3" onclick="window.setRating(3)"></i>
                        <i class="far fa-star star" data-rating="4" onclick="window.setRating(4)"></i>
                        <i class="far fa-star star" data-rating="5" onclick="window.setRating(5)"></i>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>نظر شما</label>
                    <textarea id="rating-comment" class="form-control" rows="3" placeholder="نظر خود را بنویسید..."></textarea>
                </div>
                
                <input type="hidden" id="rating-bid-id">
                <input type="hidden" id="rating-seller-id">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeModal('rating-modal')">بعداً</button>
                <button class="btn btn-primary" onclick="window.submitRating()">ثبت امتیاز</button>
            </div>
        </div>
    </div>

    <!-- فوتر -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>B2BSteel</h3>
                    <p>پلتفرم تخصصی قالب فلزی بتن و سوله</p>
                </div>
                <div class="footer-section">
                    <h3>لینک‌های سریع</h3>
                    <ul style="list-style: none;">
                        <li><a href="#" onclick="window.showPage('home')">خانه</a></li>
                        <li><a href="#" onclick="window.showPage('terms')">قوانین</a></li>
                        <li><a href="#" onclick="window.showPage('guide')">راهنما</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>تماس با ما</h3>
                    <ul style="list-style: none;">
                        <li><i class="fas fa-phone"></i> ۰۲۱-۱۲۳۴۵۶۷۸</li>
                        <li><i class="fas fa-envelope"></i> info@b2bsteel.ir</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© ۱۴۰۴ B2BSteel</p>
            </div>
        </div>
    </footer>
</main>

<!-- ========== اسکریپت‌ها ========== -->
<script type="importmap">
    {
        "imports": {
            "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2"
        }
    }
</script>

<script type="module">
    // ========== ایمپورت ==========
    import { supabase } from './supabaseClient.js';
    
    window.supabase = supabase;
    let currentUser = JSON.parse(localStorage.getItem('current_user')) || null;
    window.currentUser = currentUser;
    let currentRating = 0;
    let slideInterval;
    
    // ========== توابع کمکی ==========
    window.toPersianNumbers = function(num) {
        const persian = ['۰','۱','۲','۳','۴','۵','۶','۷','۸','۹'];
        return num.toString().replace(/\d/g, d => persian[d]);
    };
    
    window.formatPriceInput = function(input) {
        let value = input.value.replace(/[^\d]/g, '');
        if (value) {
            input.value = parseInt(value).toLocaleString('fa-IR');
        }
        if (typeof window.calculateFormworkTotal === 'function') {
            window.calculateFormworkTotal();
        }
    };
    
    // ========== اسلایدشو ==========
    window.initSlideshow = function() {
        if (slideInterval) clearInterval(slideInterval);
        slideInterval = setInterval(window.nextSlide, 10000);
    };
    
    window.nextSlide = function() {
        const slides = document.querySelectorAll('.hero-slide');
        if (slides.length === 0) return;
        
        const current = document.querySelector('.hero-slide.active');
        const currentIndex = Array.from(slides).indexOf(current);
        
        current.classList.remove('active');
        const nextIndex = (currentIndex + 1) % slides.length;
        slides[nextIndex].classList.add('active');
    };
    
    // ========== نمایش صفحات ==========
    window.showPage = function(pageId) {
        document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        const target = document.getElementById(`${pageId}-page`);
        if (target) target.classList.remove('hidden');
        
        window.updateNavigation();
        
        if (pageId === 'dashboard') window.loadDashboard();
        else if (pageId === 'admin') window.loadAdminPanel();
        else if (pageId === 'seller-formwork-dashboard') window.loadSellerFormworkDashboard();
        else if (pageId === 'seller-shed-dashboard') window.loadSellerShedDashboard();
        else if (pageId === 'home') {
            window.loadCounters();
            window.initSlideshow();
        }
    };
    
    // ========== شمارنده‌ها ==========
    window.loadCounters = async function() {
        try {
            const { count: sellers } = await supabase
                .from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'seller');
            const { count: buyers } = await supabase
                .from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'buyer');
            
            document.getElementById('counter-sellers').textContent = sellers || 0;
            document.getElementById('counter-buyers').textContent = buyers || 0;
            document.getElementById('counter-transactions').textContent = '۰';
        } catch (error) {
            console.error(error);
        }
    };
    
    // ========== ناوبری ==========
    window.updateNavigation = function() {
        const auth = document.getElementById('auth-buttons');
        const user = document.getElementById('user-menu');
        const sellerF = document.getElementById('seller-formwork-menu');
        const sellerS = document.getElementById('seller-shed-menu');
        const admin = document.getElementById('admin-menu');
        
        if (currentUser) {
            auth.classList.add('hidden');
            if (currentUser.isAdmin) {
                admin.classList.remove('hidden');
                user.classList.add('hidden');
                sellerF.classList.add('hidden');
                sellerS.classList.add('hidden');
            } else if (currentUser.userType === 'buyer') {
                user.classList.remove('hidden');
                admin.classList.add('hidden');
                sellerF.classList.add('hidden');
                sellerS.classList.add('hidden');
            } else if (currentUser.userType === 'seller') {
                if (currentUser.sellerType === 'formwork') {
                    sellerF.classList.remove('hidden');
                    user.classList.add('hidden');
                    admin.classList.add('hidden');
                    sellerS.classList.add('hidden');
                } else if (currentUser.sellerType === 'shed') {
                    sellerS.classList.remove('hidden');
                    user.classList.add('hidden');
                    admin.classList.add('hidden');
                    sellerF.classList.add('hidden');
                }
            }
        } else {
            auth.classList.remove('hidden');
            user.classList.add('hidden');
            sellerF.classList.add('hidden');
            sellerS.classList.add('hidden');
            admin.classList.add('hidden');
        }
    };
    
    window.closeModal = function(modalId) {
        document.getElementById(modalId)?.classList.remove('active');
    };
    
    // ========== انتخاب نوع کاربر ==========
    window.selectUserType = function(type) {
        selectedUserType = type;
        document.querySelectorAll('#user-type-main-selector .user-type-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.type === type);
        });
        document.getElementById('seller-type-section').classList.toggle('hidden', type !== 'seller');
    };
    
    window.selectUserLegalType = function(type) {
        selectedUserLegalType = type;
        document.querySelectorAll('#user-legal-type-selector .user-type-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.type === type);
        });
        document.getElementById('company-fields').style.display = type === 'company' ? 'block' : 'none';
    };
    
    window.selectSellerType = function(type) {
        selectedSellerType = type;
        document.querySelectorAll('#seller-type-selector .user-type-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.type === type);
        });
    };
    
    let selectedUserType = 'buyer';
    let selectedUserLegalType = 'company';
    let selectedSellerType = 'formwork';
    
    // ========== ثبت‌نام ==========
    window.handleRegister = async function(data) {
        try {
            const { data: auth, error } = await supabase.auth.signUp({
                email: data.email,
                password: data.password,
                options: {
                    data: {
                        full_name: data.contactPerson,
                        phone: data.phone,
                        user_type: data.userType,
                        seller_type: data.sellerType,
                        company_name: data.company,
                        user_legal_type: data.userLegalType
                    }
                }
            });
            if (error) throw error;
            
            if (auth.user) {
                await supabase.from('profiles').insert([{
                    user_id: auth.user.id,
                    email: data.email,
                    full_name: data.contactPerson,
                    phone: data.phone,
                    user_type: data.userType,
                    seller_type: data.sellerType,
                    company_name: data.company,
                    user_legal_type: data.userLegalType,
                    verification_status: 'pending',
                    role: 'user'
                }]);
                
                currentUser = {
                    id: auth.user.id,
                    email: data.email,
                    userType: data.userType,
                    sellerType: data.sellerType,
                    full_name: data.contactPerson,
                    companyName: data.company,
                    userLegalType: data.userLegalType,
                    isAdmin: false
                };
                localStorage.setItem('current_user', JSON.stringify(currentUser));
                window.currentUser = currentUser;
            }
            return { success: true };
        } catch (error) {
            return { success: false, error: error.message };
        }
    };
    
    // ========== ورود ==========
    window.handleLogin = async function(email, password) {
        try {
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
            
            const { data: profile } = await supabase
                .from('profiles')
                .select('*')
                .eq('user_id', data.user.id)
                .single();
            
            currentUser = {
                id: data.user.id,
                email: data.user.email,
                userType: profile?.user_type || 'buyer',
                sellerType: profile?.seller_type,
                full_name: profile?.full_name,
                companyName: profile?.company_name,
                userLegalType: profile?.user_legal_type,
                isAdmin: profile?.role === 'admin'
            };
            localStorage.setItem('current_user', JSON.stringify(currentUser));
            window.currentUser = currentUser;
            return { success: true, user: currentUser };
        } catch (error) {
            return { success: false, error: error.message };
        }
    };
    
    window.logout = async function() {
        await supabase.auth.signOut();
        currentUser = null;
        localStorage.removeItem('current_user');
        window.currentUser = null;
        window.showPage('home');
    };
    
    // ========== فرم ثبت‌نام ==========
    document.getElementById('register-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (document.getElementById('reg-password').value !== document.getElementById('reg-password-confirm').value) {
            alert('رمز عبور مطابقت ندارد');
            return;
        }
        
        const result = await window.handleRegister({
            email: document.getElementById('reg-email').value,
            password: document.getElementById('reg-password').value,
            contactPerson: document.getElementById('reg-contact').value,
            phone: document.getElementById('reg-phone').value,
            company: document.getElementById('reg-company').value,
            position: document.getElementById('reg-position').value,
            userType: selectedUserType,
            sellerType: selectedUserType === 'seller' ? selectedSellerType : null,
            userLegalType: selectedUserLegalType
        });
        
        if (result.success) {
            alert('ثبت‌نام موفق');
            if (selectedUserType === 'buyer') window.showPage('dashboard');
            else if (selectedUserType === 'seller' && selectedSellerType === 'formwork') window.showPage('seller-formwork-dashboard');
            else if (selectedUserType === 'seller' && selectedSellerType === 'shed') window.showPage('seller-shed-dashboard');
        } else {
            alert(result.error);
        }
    });
    
    // ========== فرم ورود ==========
    document.getElementById('login-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const result = await window.handleLogin(
            document.getElementById('login-email').value,
            document.getElementById('login-password').value
        );
        
        if (result.success) {
            if (result.user.isAdmin) window.showPage('admin');
            else if (result.user.userType === 'buyer') window.showPage('dashboard');
            else if (result.user.userType === 'seller' && result.user.sellerType === 'formwork') window.showPage('seller-formwork-dashboard');
            else if (result.user.userType === 'seller' && result.user.sellerType === 'shed') window.showPage('seller-shed-dashboard');
        } else {
            alert('ایمیل یا رمز اشتباه است');
        }
    });
    
    // ========== توابع سوله ==========
    window.toggleDrawingUpload = function(show) {
        document.getElementById('drawing-upload-section').classList.toggle('hidden', !show);
    };
    
    window.toggleCraneDetails = function(show) {
        document.getElementById('crane-details-section').classList.toggle('hidden', !show);
    };
    
    window.toggleOtherPaintType = function() {
        const paint = document.getElementById('paint-type');
        const other = document.getElementById('other-paint-type');
        other.classList.toggle('hidden', paint.value !== 'other');
    };
    
    window.loadSecondhandSheds = function() {
        alert('بخش سوله دست دوم در حال توسعه است');
    };
    
    window.showNewShedRequestModal = function() {
        window.showPage('new-shed-request');
    };
    
    window.showNewConcreteRequest = function() {
        window.showPage('new-concrete-request');
    };
    
    // ========== فرم درخواست سوله ==========
    document.getElementById('new-shed-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!currentUser) {
            alert('لطفاً وارد شوید');
            window.showPage('login');
            return;
        }
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        const responsibilities = Array.from(document.querySelectorAll('input[name="responsibility"]:checked')).map(cb => cb.value);
        
        const data = {
            user_id: user.id,
            dimensions: {
                length: parseFloat(document.getElementById('shed-length').value),
                width: parseFloat(document.getElementById('shed-width').value),
                height: parseFloat(document.getElementById('shed-height').value)
            },
            usage: document.getElementById('shed-usage').value,
            location: document.getElementById('shed-location').value,
            has_drawing: document.querySelector('input[name="has-drawing"]:checked')?.value === 'yes',
            needs_crane: document.querySelector('input[name="needs-crane"]:checked')?.value === 'yes',
            crane_tonnage: document.getElementById('crane-tonnage').value || null,
            foundation: document.querySelector('input[name="foundation"]:checked')?.value,
            sandblast: document.querySelector('input[name="sandblast"]:checked')?.value,
            paint_type: document.getElementById('paint-type').value,
            other_paint_type: document.getElementById('other-paint-type').value,
            paint_thickness: parseInt(document.getElementById('paint-thickness').value),
            weight: document.getElementById('shed-weight').value || null,
            price_type: document.querySelector('input[name="price-type"]:checked')?.value || 'estimated',
            buyer_responsibilities: responsibilities,
            status: 'open',
            created_at: new Date().toISOString()
        };
        
        try {
            const { error } = await supabase.from('shed_requests').insert([data]);
            if (error) throw error;
            alert('✅ درخواست سوله با موفقیت ثبت شد');
            window.showPage('dashboard');
        } catch (error) {
            alert('❌ خطا: ' + error.message);
        }
    });
    
    // ========== فرم درخواست قالب بتن ==========
    document.getElementById('new-concrete-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!currentUser) {
            alert('لطفاً وارد شوید');
            window.showPage('login');
            return;
        }
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        const items = Array.from(document.querySelectorAll('input[name="concrete-items"]:checked')).map(cb => cb.value);
        
        const data = {
            user_id: user.id,
            title: document.getElementById('concrete-title').value,
            description: document.getElementById('concrete-description').value,
            items: items,
            material: document.getElementById('concrete-material').value,
            project_location: document.getElementById('concrete-location').value,
            status: 'open',
            created_at: new Date().toISOString()
        };
        
        try {
            const { error } = await supabase.from('concrete_requests').insert([data]);
            if (error) throw error;
            alert('✅ درخواست قالب بتن با موفقیت ثبت شد');
            window.showPage('dashboard');
        } catch (error) {
            alert('❌ خطا: ' + error.message);
        }
    });
    
    // ========== داشبورد خریدار ==========
    window.loadDashboard = async function() {
        if (!currentUser) return;
        
        document.getElementById('user-name').textContent = currentUser.full_name || 'کاربر';
        document.getElementById('user-type').textContent = `نوع حساب: ${currentUser.userType === 'buyer' ? 'خریدار' : ''}`;
        document.getElementById('user-avatar').textContent = (currentUser.full_name || '?').charAt(0);
        
        await window.loadMyRequests('all');
    };
    
    window.loadMyRequests = async function(type = 'all') {
        if (!currentUser) return;
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        let requests = [];
        
        if (type === 'all' || type === 'concrete') {
            const { data: concrete } = await supabase
                .from('concrete_requests')
                .select('*')
                .eq('user_id', user.id)
                .order('created_at', { ascending: false });
            if (concrete) requests.push(...concrete.map(r => ({ ...r, requestType: 'concrete' })));
        }
        
        if (type === 'all' || type === 'shed') {
            const { data: shed } = await supabase
                .from('shed_requests')
                .select('*')
                .eq('user_id', user.id)
                .order('created_at', { ascending: false });
            if (shed) requests.push(...shed.map(r => ({ ...r, requestType: 'shed' })));
        }
        
        const container = document.getElementById('buyer-requests-container');
        if (!requests.length) {
            container.innerHTML = '<p style="text-align: center; color: var(--muted);">درخواستی یافت نشد</p>';
            return;
        }
        
        let html = '';
        for (const req of requests) {
            const bids = await window.loadBidsForRequest(req.id, req.requestType);
            
            html += `
                <div class="request-item">
                    <div class="request-header">
                        <div class="request-title">${req.title || 'درخواست ' + (req.requestType === 'concrete' ? 'قالب' : 'سوله')}</div>
                        <span class="request-badge badge-${req.status}">${req.status === 'open' ? 'باز' : 'بسته'}</span>
                    </div>
                    <div class="request-details">
                        <div><strong>تاریخ:</strong> ${new Date(req.created_at).toLocaleDateString('fa-IR')}</div>
                        ${req.project_location ? `<div><strong>مکان:</strong> ${req.project_location}</div>` : ''}
                        ${req.location ? `<div><strong>مکان:</strong> ${req.location}</div>` : ''}
                        ${req.dimensions ? `<div><strong>ابعاد:</strong> ${req.dimensions.length}×${req.dimensions.width}×${req.dimensions.height}</div>` : ''}
                    </div>
                    
                    ${bids.length ? `
                        <div style="margin-top: 15px;">
                            <strong>پیشنهادات دریافتی (${bids.length}):</strong>
                            ${bids.map(bid => `
                                <div class="bid-item">
                                    <div class="bid-header">
                                        <span class="bid-price">${window.toPersianNumbers(bid.total_price || bid.price)} ریال</span>
                                        <span>زمان تحویل: ${bid.delivery_time || bid.construction_time || '?'} روز</span>
                                    </div>
                                    <div style="font-size: 0.9rem; margin: 5px 0;">${bid.notes ? '📝 ' + bid.notes.substring(0, 50) + '...' : ''}</div>
                                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px;">
                                        ${!bid.selected ? `
                                            <button class="btn btn-success btn-sm" onclick="window.selectBid('${bid.id}', '${req.requestType}')">انتخاب</button>
                                        ` : '<span style="color: green; font-weight: bold;">✓ انتخاب شده</span>'}
                                        <button class="btn btn-info btn-sm" onclick="window.viewBidDetails('${bid.id}', '${req.requestType}')">جزئیات</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p style="color: #999; margin-top: 10px;">تاکنون پیشنهادی دریافت نشده</p>'}
                </div>
            `;
        }
        
        container.innerHTML = html;
    };
    
    window.loadBidsForRequest = async function(requestId, type) {
        const table = type === 'concrete' ? 'formwork_bids' : 'shed_bids';
        const { data } = await supabase
            .from(table)
            .select('*')
            .eq('request_id', requestId)
            .order('created_at', { ascending: false });
        return data || [];
    };
    
    window.viewBidDetails = function(bidId, type) {
        alert(`مشاهده جزئیات پیشنهاد - کد: ${bidId}`);
    };
    
    // ========== داشبورد فروشنده قالب ==========
    window.loadSellerFormworkDashboard = async function() {
        if (!currentUser) return;
        
        document.getElementById('seller-formwork-name').textContent = currentUser.full_name || 'فروشنده قالب';
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        try {
            const { count: bidsCount } = await supabase
                .from('formwork_bids')
                .select('*', { count: 'exact', head: true })
                .eq('seller_id', user.id);
            
            const { count: selectedCount } = await supabase
                .from('formwork_bids')
                .select('*', { count: 'exact', head: true })
                .eq('seller_id', user.id)
                .eq('selected', true);
            
            document.getElementById('formwork-bids-count').textContent = bidsCount || 0;
            document.getElementById('formwork-selected-count').textContent = selectedCount || 0;
            
            const { data: requests } = await supabase
                .from('concrete_requests')
                .select('*')
                .eq('status', 'open')
                .order('created_at', { ascending: false });
            
            const container = document.getElementById('seller-formwork-requests');
            
            if (!requests?.length) {
                container.innerHTML = '<p style="text-align: center; color: var(--muted);">درخواستی وجود ندارد</p>';
                return;
            }
            
            let html = '';
            for (const req of requests) {
                const { data: existing } = await supabase
                    .from('formwork_bids')
                    .select('id')
                    .eq('request_id', req.id)
                    .eq('seller_id', user.id);
                
                html += `
                    <div class="request-item">
                        <div class="request-header">
                            <div class="request-title">${req.title || 'بدون عنوان'}</div>
                            <span class="request-badge badge-open">باز</span>
                        </div>
                        <div class="request-details">
                            <div><strong>مکان:</strong> ${req.project_location || 'نامشخص'}</div>
                            <div><strong>مواد:</strong> ${req.material || 'نامشخص'}</div>
                        </div>
                        <div class="request-actions">
                            ${!existing?.length ? `
                                <button class="btn btn-primary" onclick="window.showFormworkBidModal('${req.id}', '${req.title || 'بدون عنوان'}', '${req.description || ''}')">
                                    ارسال پیشنهاد
                                </button>
                            ` : '<span style="color: green; padding: 8px;">✓ پیشنهاد ارسال شده</span>'}
                            <button class="btn btn-info" onclick="window.viewRequestDetails('${req.id}')">مشاهده</button>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
        } catch (error) {
            console.error('خطا:', error);
        }
    };
    
    // ========== داشبورد فروشنده سوله ==========
    window.loadSellerShedDashboard = async function() {
        if (!currentUser) return;
        
        document.getElementById('seller-shed-name').textContent = currentUser.full_name || 'فروشنده سوله';
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        try {
            const { count: bidsCount } = await supabase
                .from('shed_bids')
                .select('*', { count: 'exact', head: true })
                .eq('seller_id', user.id);
            
            const { count: selectedCount } = await supabase
                .from('shed_bids')
                .select('*', { count: 'exact', head: true })
                .eq('seller_id', user.id)
                .eq('selected', true);
            
            document.getElementById('shed-bids-count').textContent = bidsCount || 0;
            document.getElementById('shed-selected-count').textContent = selectedCount || 0;
            
            const { data: requests } = await supabase
                .from('shed_requests')
                .select('*')
                .eq('status', 'open')
                .order('created_at', { ascending: false });
            
            const container = document.getElementById('seller-shed-requests');
            
            if (!requests?.length) {
                container.innerHTML = '<p style="text-align: center; color: var(--muted);">درخواستی وجود ندارد</p>';
                return;
            }
            
            let html = '';
            for (const req of requests) {
                const { data: existing } = await supabase
                    .from('shed_bids')
                    .select('id')
                    .eq('request_id', req.id)
                    .eq('seller_id', user.id);
                
                const dims = req.dimensions || {};
                
                html += `
                    <div class="request-item">
                        <div class="request-header">
                            <div class="request-title">درخواست سوله</div>
                            <span class="request-badge badge-open">باز</span>
                        </div>
                        <div class="request-details">
                            <div><strong>ابعاد:</strong> ${dims.length || '?'}×${dims.width || '?'}×${dims.height || '?'}</div>
                            <div><strong>مکان:</strong> ${req.location || 'نامشخص'}</div>
                        </div>
                        <div class="request-actions">
                            ${!existing?.length ? `
                                <button class="btn btn-primary" onclick='window.showShedBidModal("${req.id}", ${JSON.stringify(dims)})'>
                                    ارسال پیشنهاد
                                </button>
                            ` : '<span style="color: green; padding: 8px;">✓ پیشنهاد ارسال شده</span>'}
                            <button class="btn btn-info" onclick="window.viewRequestDetails('${req.id}')">مشاهده</button>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
        } catch (error) {
            console.error('خطا:', error);
        }
    };
    
    window.viewRequestDetails = function(requestId) {
        alert(`مشاهده جزئیات درخواست - کد: ${requestId}`);
    };
    
    // ========== مودال پیشنهاد قالب ==========
    window.showFormworkBidModal = function(requestId, title, description) {
        document.getElementById('bid-request-id').value = requestId;
        document.getElementById('bid-project-title').textContent = title;
        document.getElementById('bid-project-details').textContent = description?.substring(0, 100) + '...';
        document.getElementById('submit-formwork-bid-modal').classList.add('active');
        
        document.getElementById('bid-base-price').value = '';
        document.getElementById('display-base-price').textContent = '۰ ریال';
        document.getElementById('display-vat').textContent = '۰ ریال';
        document.getElementById('display-loading').textContent = '۰ ریال';
        document.getElementById('display-total').textContent = '۰ ریال';
    };
    
    window.calculateFormworkTotal = function() {
        const baseInput = document.getElementById('bid-base-price');
        if (!baseInput) return;
        
        const base = parseInt(baseInput.value.replace(/[^\d]/g, '')) || 0;
        const vatPercent = parseInt(document.getElementById('bid-vat').value) || 0;
        const loadingPercent = parseInt(document.getElementById('bid-loading').value) || 0;
        
        const vat = Math.round(base * vatPercent / 100);
        const loading = Math.round(base * loadingPercent / 100);
        const total = base + vat + loading;
        
        document.getElementById('display-base-price').textContent = base.toLocaleString('fa-IR') + ' ریال';
        document.getElementById('display-vat').textContent = vat.toLocaleString('fa-IR') + ' ریال';
        document.getElementById('display-loading').textContent = loading.toLocaleString('fa-IR') + ' ریال';
        document.getElementById('display-total').textContent = total.toLocaleString('fa-IR') + ' ریال';
    };
    
    window.submitFormworkBid = async function() {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        const basePrice = parseInt(document.getElementById('bid-base-price').value.replace(/[^\d]/g, '')) || 0;
        if (basePrice === 0) {
            alert('لطفاً قیمت را وارد کنید');
            return;
        }
        
        const vatPercent = parseInt(document.getElementById('bid-vat').value) || 0;
        const loadingPercent = parseInt(document.getElementById('bid-loading').value) || 0;
        const vat = Math.round(basePrice * vatPercent / 100);
        const loading = Math.round(basePrice * loadingPercent / 100);
        const total = basePrice + vat + loading;
        
        const bid = {
            request_id: document.getElementById('bid-request-id').value,
            seller_id: user.id,
            base_price: basePrice,
            vat_percent: vatPercent,
            loading_percent: loadingPercent,
            vat_amount: vat,
            loading_amount: loading,
            total_price: total,
            delivery_time: parseInt(document.getElementById('bid-delivery').value),
            warranty_months: parseInt(document.getElementById('bid-warranty').value),
            notes: document.getElementById('bid-notes').value,
            selected: false,
            created_at: new Date().toISOString()
        };
        
        try {
            const { error } = await supabase.from('formwork_bids').insert([bid]);
            if (error) throw error;
            alert('✅ پیشنهاد با موفقیت ارسال شد');
            window.closeModal('submit-formwork-bid-modal');
            window.loadSellerFormworkDashboard();
        } catch (error) {
            alert('❌ خطا: ' + error.message);
        }
    };
    
    // ========== مودال پیشنهاد سوله ==========
    window.showShedBidModal = function(requestId, dimensions) {
        document.getElementById('shed-bid-request-id').value = requestId;
        document.getElementById('shed-bid-project-title').textContent = 'درخواست سوله';
        document.getElementById('shed-bid-dimensions').textContent = `${dimensions.length || '?'}×${dimensions.width || '?'}×${dimensions.height || '?'}`;
        document.getElementById('submit-shed-bid-modal').classList.add('active');
        
        document.getElementById('shed-bid-price').value = '';
    };
    
    window.submitShedBid = async function() {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        const price = parseInt(document.getElementById('shed-bid-price').value.replace(/[^\d]/g, '')) || 0;
        if (price === 0) {
            alert('لطفاً قیمت را وارد کنید');
            return;
        }
        
        const bid = {
            request_id: document.getElementById('shed-bid-request-id').value,
            seller_id: user.id,
            price: price,
            weight: parseFloat(document.getElementById('shed-bid-weight').value) || 0,
            construction_time: parseInt(document.getElementById('shed-bid-construction-time').value),
            installation_time: parseInt(document.getElementById('shed-bid-installation-time').value),
            warranty_months: parseInt(document.getElementById('shed-bid-warranty').value),
            notes: document.getElementById('shed-bid-notes').value,
            selected: false,
            created_at: new Date().toISOString()
        };
        
        try {
            const { error } = await supabase.from('shed_bids').insert([bid]);
            if (error) throw error;
            alert('✅ پیشنهاد با موفقیت ارسال شد');
            window.closeModal('submit-shed-bid-modal');
            window.loadSellerShedDashboard();
        } catch (error) {
            alert('❌ خطا: ' + error.message);
        }
    };
    
    // ========== انتخاب پیشنهاد ==========
    window.selectBid = async function(bidId, type) {
        if (!confirm('آیا از انتخاب این پیشنهاد اطمینان دارید؟')) return;
        
        const table = type === 'concrete' ? 'formwork_bids' : 'shed_bids';
        
        try {
            const { data: bid } = await supabase.from(table).select('request_id').eq('id', bidId).single();
            
            await supabase
                .from(table)
                .update({ selected: false })
                .eq('request_id', bid.request_id);
            
            await supabase
                .from(table)
                .update({ selected: true })
                .eq('id', bidId);
            
            alert('✅ پیشنهاد انتخاب شد');
            window.loadMyRequests('all');
        } catch (error) {
            alert(error.message);
        }
    };
    
    // ========== امتیاز دهی ==========
    window.showRatingModal = function(bidId, sellerId) {
        document.getElementById('rating-bid-id').value = bidId;
        document.getElementById('rating-seller-id').value = sellerId;
        document.getElementById('rating-seller-info').textContent = 'امتیاز به فروشنده';
        document.getElementById('rating-modal').classList.add('active');
    };
    
    window.setRating = function(rating) {
        currentRating = rating;
        document.querySelectorAll('.rating-stars .star').forEach((star, index) => {
            if (index < rating) {
                star.classList.remove('far');
                star.classList.add('fas');
                star.classList.add('active');
            } else {
                star.classList.remove('fas');
                star.classList.add('far');
                star.classList.remove('active');
            }
        });
    };
    
    window.submitRating = async function() {
        if (!currentRating) {
            alert('لطفاً امتیاز را انتخاب کنید');
            return;
        }
        
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return;
        
        const rating = {
            bid_id: document.getElementById('rating-bid-id').value,
            seller_id: document.getElementById('rating-seller-id').value,
            buyer_id: user.id,
            rating: currentRating,
            comment: document.getElementById('rating-comment').value,
            created_at: new Date().toISOString()
        };
        
        try {
            const { error } = await supabase.from('ratings').insert([rating]);
            if (error) throw error;
            alert('✅ امتیاز شما ثبت شد');
            window.closeModal('rating-modal');
        } catch (error) {
            alert(error.message);
        }
    };
    
    // ========== پنل ادمین ==========
    window.loadAdminPanel = async function() {
        try {
            const { count: totalUsers } = await supabase.from('profiles').select('*', { count: 'exact', head: true });
            const { count: buyers } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'buyer');
            const { count: formworkSellers } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'seller').eq('seller_type', 'formwork');
            const { count: shedSellers } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'seller').eq('seller_type', 'shed');
            const { count: concreteReqs } = await supabase.from('concrete_requests').select('*', { count: 'exact', head: true });
            const { count: shedReqs } = await supabase.from('shed_requests').select('*', { count: 'exact', head: true });
            
            document.getElementById('admin-total-users').textContent = totalUsers || 0;
            document.getElementById('admin-total-buyers').textContent = buyers || 0;
            document.getElementById('admin-formwork-sellers').textContent = formworkSellers || 0;
            document.getElementById('admin-shed-sellers').textContent = shedSellers || 0;
            document.getElementById('admin-concrete-requests').textContent = concreteReqs || 0;
            document.getElementById('admin-shed-requests').textContent = shedReqs || 0;
            
            window.loadAdminTab('users');
        } catch (error) {
            console.error('خطا:', error);
        }
    };
    
    window.loadAdminTab = async function(tab) {
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        
        const content = document.getElementById('admin-content');
        
        if (tab === 'users') {
            const { data: users } = await supabase.from('profiles').select('*').order('created_at', { ascending: false });
            
            let html = '<div class="requests-list">';
            users?.forEach(user => {
                html += `
                    <div class="request-item">
                        <div class="request-header">
                            <div class="request-title">${user.full_name || 'بدون نام'}</div>
                            <span class="request-badge ${user.role === 'admin' ? 'badge-warning' : 'badge-info'}">${user.role === 'admin' ? 'ادمین' : (user.user_type === 'buyer' ? 'خریدار' : 'فروشنده')}</span>
                        </div>
                        <div class="request-details">
                            <div><strong>ایمیل:</strong> ${user.email}</div>
                            <div><strong>شرکت:</strong> ${user.company_name || '—'}</div>
                            <div><strong>تلفن:</strong> ${user.phone || '—'}</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            content.innerHTML = html;
            
        } else if (tab === 'concrete-requests') {
            const { data: requests } = await supabase
                .from('concrete_requests')
                .select('*')
                .order('created_at', { ascending: false });
            
            let html = '';
            for (const req of requests || []) {
                const { data: bids } = await supabase
                    .from('formwork_bids')
                    .select('*, profiles(full_name, company_name)')
                    .eq('request_id', req.id);
                
                html += `
                    <div class="request-with-bids">
                        <div class="request-header">
                            <div class="request-title">${req.title || 'درخواست قالب'}</div>
                            <span class="request-badge badge-${req.status}">${req.status}</span>
                        </div>
                        <div class="request-details">
                            <div><strong>مکان:</strong> ${req.project_location || '—'}</div>
                            <div><strong>مواد:</strong> ${req.material || '—'}</div>
                            <div><strong>تاریخ:</strong> ${new Date(req.created_at).toLocaleDateString('fa-IR')}</div>
                        </div>
                        
                        <div class="bids-container">
                            <h4>پاسخ استعلام‌ها (${bids?.length || 0})</h4>
                            ${bids?.map(bid => `
                                <div class="bid-item">
                                    <div><strong>فروشنده:</strong> ${bid.profiles?.full_name || '—'} (${bid.profiles?.company_name || '—'})</div>
                                    <div><strong>قیمت کل:</strong> ${bid.total_price?.toLocaleString('fa-IR')} ریال</div>
                                    <div><strong>زمان تحویل:</strong> ${bid.delivery_time} روز</div>
                                    <div><strong>وضعیت:</strong> ${bid.selected ? '✅ انتخاب شده' : '⏳ در انتظار'}</div>
                                </div>
                            `).join('') || '<p>پاسخی ثبت نشده</p>'}
                        </div>
                    </div>
                `;
            }
            content.innerHTML = html || '<p>درخواستی وجود ندارد</p>';
            
        } else if (tab === 'shed-requests') {
            const { data: requests } = await supabase
                .from('shed_requests')
                .select('*')
                .order('created_at', { ascending: false });
            
            let html = '';
            for (const req of requests || []) {
                const { data: bids } = await supabase
                    .from('shed_bids')
                    .select('*, profiles(full_name, company_name)')
                    .eq('request_id', req.id);
                
                const dims = req.dimensions || {};
                
                html += `
                    <div class="request-with-bids">
                        <div class="request-header">
                            <div class="request-title">درخواست سوله</div>
                            <span class="request-badge badge-${req.status}">${req.status}</span>
                        </div>
                        <div class="request-details">
                            <div><strong>ابعاد:</strong> ${dims.length || '?'}×${dims.width || '?'}×${dims.height || '?'}</div>
                            <div><strong>مکان:</strong> ${req.location || '—'}</div>
                            <div><strong>کاربری:</strong> ${req.usage || '—'}</div>
                        </div>
                        
                        <div class="bids-container">
                            <h4>پاسخ استعلام‌ها (${bids?.length || 0})</h4>
                            ${bids?.map(bid => `
                                <div class="bid-item">
                                    <div><strong>فروشنده:</strong> ${bid.profiles?.full_name || '—'} (${bid.profiles?.company_name || '—'})</div>
                                    <div><strong>قیمت:</strong> ${bid.price?.toLocaleString('fa-IR')} ریال</div>
                                    <div><strong>وزن:</strong> ${bid.weight} تن</div>
                                    <div><strong>وضعیت:</strong> ${bid.selected ? '✅ انتخاب شده' : '⏳ در انتظار'}</div>
                                </div>
                            `).join('') || '<p>پاسخی ثبت نشده</p>'}
                        </div>
                    </div>
                `;
            }
            content.innerHTML = html || '<p>درخواستی وجود ندارد</p>';
            
        } else if (tab === 'transactions') {
            content.innerHTML = '<p style="text-align: center; padding: 2rem;">بخش تراکنش‌ها در حال توسعه است</p>';
        }
    };
    
    window.enterConcreteFormworkSystem = function() {
        if (currentUser) {
            if (currentUser.userType === 'buyer') window.showPage('dashboard');
            else if (currentUser.userType === 'seller' && currentUser.sellerType === 'formwork') window.showPage('seller-formwork-dashboard');
            else if (currentUser.userType === 'seller' && currentUser.sellerType === 'shed') window.showPage('seller-shed-dashboard');
            else if (currentUser.isAdmin) window.showPage('admin');
        } else {
            window.showPage('login');
        }
    };
    
    // ========== مقداردهی اولیه ==========
    document.addEventListener('DOMContentLoaded', function() {
        window.updateNavigation();
        window.showPage('home');
        window.loadCounters();
        window.initSlideshow();
    });
</script>
</body>
</html>