<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B2BSteel | پلتفرم تخصصی قالب فلزی بتن و سوله</title>
    
    <!-- فونت و آیکون -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========== متغیرهای رنگ ========== */
        :root {
            --primary: #004586;
            --primary-dark: #002f5c;
            --accent: #E6B800;
            --bg: #F7F7F7;
            --card-bg: #FFFFFF;
            --muted: #6b7280;
            --dark: #1E1E1E;
            --text-dark: #2A2A2A;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg);
            color: var(--dark);
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            cursor: pointer;
            border: none;
            background: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.8s ease forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== ناوبری ========== */
        .navbar {
            background: var(--card-bg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: all 0.3s;
        }

        .navbar:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            background: var(--primary);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-text .slogan {
            font-size: 0.8rem;
            color: var(--accent);
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .nav-link {
            color: #4b5563;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s;
            font-size: 1.1rem;
            white-space: nowrap;
        }

        .nav-link:hover {
            background: #f3f4f6;
            color: var(--primary);
        }

        .btn {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--muted);
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.85rem;
        }

        .hero {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 4rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 20%, rgba(230,184,0,0.15), transparent 70%),
                        radial-gradient(circle at 80% 80%, rgba(0,69,134,0.2), transparent 70%);
            z-index: 0;
        }

        .hero .container {
            position: relative;
            z-index: 1;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            opacity: 0.95;
        }

        .hero-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .counters {
            background: white;
            padding: 3rem 0;
            margin: 2rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .counters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .counter-item {
            text-align: center;
            padding: 1.5rem;
        }

        .counter-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .counter-label {
            font-size: 1.2rem;
            color: #4b5563;
        }

        .image-slider {
            width: 100%;
            height: 450px;
            position: relative;
            overflow: hidden;
            margin: 2rem 0;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .slider-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .slider-image.active {
            opacity: 1;
        }

        .features {
            padding: 4rem 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            color: var(--primary);
            font-size: 2rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.06);
            transition: all 0.35s;
            height: 100%;
        }

        .feature-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }

        .feature-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.7rem;
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .auth-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .auth-card {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .auth-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4b5563;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-help {
            font-size: 0.85rem;
            color: var(--muted);
            margin-top: 0.25rem;
        }

        .user-type-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .user-type-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            background: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-type-btn.active {
            border-color: var(--primary);
            background: #eff6ff;
            color: var(--primary);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--muted);
            cursor: pointer;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dashboard {
            padding: 2rem 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .dashboard-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .requests-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .request-item {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .request-item:last-child {
            border-bottom: none;
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .request-title {
            font-size: 1.2rem;
            color: var(--primary);
        }

        .request-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-open {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-in-progress {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-closed {
            background: #e5e7eb;
            color: #374151;
        }

        .badge-selected {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .request-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            color: #6b7280;
            font-size: 0.9rem;
        }

        .request-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .admin-stat-card h3 {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .admin-stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .footer {
            background: var(--primary-dark);
            color: #ddd;
            padding: 4rem 0;
            margin-top: 4rem;
        }

        .footer h3 {
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .footer a {
            color: #ccc;
            transition: color 0.2s;
        }

        .footer a:hover {
            color: var(--accent);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid #374151;
            color: #9ca3af;
        }

        @media (max-width: 992px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }
            .nav-links {
                justify-content: center;
            }
        }
        @media (max-width: 768px) {
            .hero h2 {
                font-size: 2rem;
            }
            .hero p {
                font-size: 1rem;
            }
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            .image-slider {
                height: 300px;
            }
            .counter-number {
                font-size: 2rem;
            }
            .date-selector {
                flex-direction: column;
            }
            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
<nav class="navbar">
    <div class="container nav-container">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-cubes"></i>
            </div>
            <div class="logo-text">
                <h1>B2BSteel</h1>
                <div class="slogan">اعتماد - شفافیت - سرعت</div>
            </div>
        </div>
        
        <div class="nav-links">
            <a href="#" class="nav-link" onclick="showPage('home')">خانه</a>
            <a href="#" class="nav-link" onclick="showPage('concrete-formwork')">قالب بتن</a>
            <a href="#" class="nav-link" onclick="showPage('shed')">سوله</a>
            <a href="#" class="nav-link" onclick="showPage('blog')">بلاگ</a>
            <a href="#" class="nav-link" onclick="showPage('terms')">قوانین</a>
            <a href="#" class="nav-link" onclick="showPage('guide')">راهنما</a>
            
            <div id="auth-buttons">
                <button class="btn btn-primary" onclick="showPage('login')">ورود</button>
                <button class="btn btn-secondary" onclick="showPage('register')">ثبت‌نام</button>
            </div>
            
            <div id="user-menu" class="hidden">
                <button class="btn btn-primary" onclick="showPage('dashboard')">داشبورد</button>
                <button class="btn btn-danger" onclick="logout()">خروج</button>
            </div>
            
            <div id="seller-formwork-menu" class="hidden">
                <button class="btn btn-primary" onclick="showPage('seller-formwork-dashboard')">داشبورد فروشنده قالب</button>
                <button class="btn btn-danger" onclick="logout()">خروج</button>
            </div>
            
            <div id="seller-shed-menu" class="hidden">
                <button class="btn btn-success" onclick="showPage('seller-shed-dashboard')">داشبورد فروشنده سوله</button>
                <button class="btn btn-danger" onclick="logout()">خروج</button>
            </div>
            
            <div id="admin-menu" class="hidden">
                <button class="btn btn-warning" onclick="showPage('admin')">پنل ادمین</button>
                <button class="btn btn-primary" onclick="showPage('dashboard')">داشبورد</button>
                <button class="btn btn-danger" onclick="logout()">خروج</button>
            </div>
        </div>
    </div>
</nav>

<main id="pages">
    <section id="home-page" class="page">
        <div class="hero fade-in">
            <div class="container">
                <h2>پلتفرم B2BSteel</h2>
                <p>اولین پلتفرم تخصصی ارتباط خریداران و فروشندگان سوله و قالب فلزی بتن</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" style="padding: 12px 25px;" onclick="showPage('register')">
                        <i class="fas fa-user-tie"></i> ثبت‌نام خریدار
                    </button>
                    <button class="btn btn-success" style="padding: 12px 25px;" onclick="showPage('register')">
                        <i class="fas fa-industry"></i> ثبت‌نام فروشنده
                    </button>
                </div>
            </div>
        </div>
        <div class="counters">
            <div class="container">
                <div class="counters-grid">
                    <div class="counter-item">
                        <div class="counter-number" id="counter-sellers">۰</div>
                        <div class="counter-label">فروشنده ثبت‌نام شده</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-number" id="counter-buyers">۰</div>
                        <div class="counter-label">خریدار ثبت‌نام شده</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-number" id="counter-transactions">۰</div>
                        <div class="counter-label">فروش نهایی شده</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="image-slider">
                <img src="https://img.edilportale.com/product-thumbs/b_P300-Pilosio-611087-rel51b5c439.jpg" alt="قالب فلزی بتن" class="slider-image active">
                <img src="https://img.edilportale.com/product-thumbs/b_P300-Pilosio-611087-rel991e93b7.jpg" alt="قالب فلزی بتن" class="slider-image">
                <div class="slider-image" style="background: linear-gradient(135deg, var(--primary-dark), var(--primary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                    <div style="text-align: center;">
                        <i class="fas fa-industry" style="font-size: 4rem; margin-bottom: 1rem;"></i>
                        <p>صنعت ساختمان</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="features">
            <div class="container">
                <h2 class="section-title">چرا B2BSteel؟</h2>
                <div class="features-grid">
                    <div class="feature-card fade-in">
                        <div class="feature-icon"><i class="fas fa-lock"></i></div>
                        <h3>حریم خصوصی کاملاً محفوظ</h3>
                        <p>اطلاعات هویتی فروشندگان تا زمان انتخاب نهایی مخفی می‌ماند.</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                        <h3>شفافیت کامل قیمت</h3>
                        <p>خریدار می‌تواند تمام پیشنهادات قیمت را به صورت شفاف مشاهده و مقایسه کند.</p>
                    </div>
                    <div class="feature-card fade-in">
                        <div class="feature-icon"><i class="fas fa-handshake"></i></div>
                        <h3>ارتباط مستقیم و سریع</h3>
                        <p>ارتباط مستقیم بین خریداران و فروشندگان معتبر بدون واسطه.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="concrete-formwork-page" class="page hidden">
        <div class="hero fade-in">
            <div class="container">
                <h2>بخش قالب فلزی بتن</h2>
                <p>خرید و فروش تخصصی انواع قالب فلزی بتن</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" onclick="showPage('register')">ثبت‌نام خریدار</button>
                    <button class="btn btn-success" onclick="showPage('register')">ثبت‌نام فروشنده</button>
                </div>
            </div>
        </div>
        <div class="container" style="padding: 4rem 0;">
            <div class="features-grid">
                <div class="feature-card fade-in">
                    <div class="feature-icon"><i class="fas fa-cube"></i></div>
                    <h3>قالب مدولار</h3>
                    <p>قالب‌بندی سریع و با کیفیت برای پروژه‌های مختلف ساختمانی</p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon"><i class="fas fa-building"></i></div>
                    <h3>قالب دیوار و ستون</h3>
                    <p>قالب‌های مخصوص دیوار و ستون با مقاومت بالا و دوام طولانی</p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon"><i class="fas fa-bridge"></i></div>
                    <h3>قالب تونل و پل</h3>
                    <p>قالب‌های تخصصی برای پروژه‌های بزرگ عمرانی</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 3rem;">
                <button class="btn btn-primary" style="padding: 15px 40px; font-size: 1.2rem;" onclick="enterConcreteFormworkSystem()">
                    <i class="fas fa-sign-in-alt"></i> ورود به سیستم قالب بتن
                </button>
            </div>
        </div>
    </section>

    <section id="shed-page" class="page hidden">
        <div class="container shed-page-container">
            <h2 class="section-title">بخش سوله</h2>
            <p style="color: var(--muted); text-align: center; max-width: 800px; margin: 0 auto 2rem;">
                انتخاب خدمات مورد نیاز خود در حوزه سوله
            </p>
            <div class="shed-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin: 3rem 0;">
                <div class="shed-option-card" style="background: white; border-radius: 10px; padding: 2.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                    <div style="width: 70px; height: 70px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; color: white;">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">سوله نو</h3>
                    <button class="btn btn-primary" onclick="showPage('new-shed-request')" style="width: 100%;">
                        <i class="fas fa-file-alt"></i> پر کردن پرسشنامه سوله نو
                    </button>
                </div>
                <div class="shed-option-card" style="background: white; border-radius: 10px; padding: 2.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                    <div style="width: 70px; height: 70px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; color: white;">
                        <i class="fas fa-warehouse"></i>
                    </div>
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">سوله دست دوم</h3>
                    <button class="btn btn-success" onclick="loadSecondhandSheds()" style="width: 100%;">
                        <i class="fas fa-search"></i> مشاهده آگهی‌ها
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section id="new-shed-request-page" class="page hidden">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto; padding: 2rem 0;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h1 style="color: var(--primary); margin-bottom: 0.5rem;">پرسشنامه درخواست سوله نو</h1>
                    <p style="color: var(--muted);">لطفاً اطلاعات پروژه خود را با دقت وارد کنید</p>
                </div>
                <form id="new-shed-form">
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-ruler-combined"></i> ابعاد سوله</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="shed-length">طول (متر)</label>
                                <input type="number" id="shed-length" class="form-control" required min="10" step="0.5">
                            </div>
                            <div class="form-group">
                                <label for="shed-width">عرض (متر)</label>
                                <input type="number" id="shed-width" class="form-control" required min="10" step="0.5">
                            </div>
                            <div class="form-group">
                                <label for="shed-height">ارتفاع (متر)</label>
                                <input type="number" id="shed-height" class="form-control" required min="4" step="0.5">
                            </div>
                        </div>
                    </div>
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-drafting-compass"></i> نقشه سازه</h3>
                        <div class="form-group">
                            <label>آیا فایل نقشه سازه دارید؟</label>
                            <div style="display: flex; gap: 1.5rem;">
                                <label><input type="radio" name="has-drawing" value="yes" onclick="toggleDrawingUpload(true)"> بله</label>
                                <label><input type="radio" name="has-drawing" value="no" checked onclick="toggleDrawingUpload(false)"> خیر</label>
                            </div>
                        </div>
                        <div id="drawing-upload-section" class="hidden">
                            <div class="form-group">
                                <label for="shed-drawing">آپلود فایل نقشه</label>
                                <input type="file" id="shed-drawing" class="form-control" accept=".pdf,.dwg,.jpg,.png">
                            </div>
                        </div>
                    </div>
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-info-circle"></i> اطلاعات پروژه</h3>
                        <div class="form-group">
                            <label for="shed-usage">کارکرد سوله</label>
                            <textarea id="shed-usage" class="form-control" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="shed-location">محل نصب</label>
                            <input type="text" id="shed-location" class="form-control" required>
                        </div>
                    </div>
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-crane"></i> جرثقیل سقفی</h3>
                        <div class="form-group">
                            <label>آیا به جرثقیل نیاز دارید؟</label>
                            <div style="display: flex; gap: 1.5rem;">
                                <label><input type="radio" name="needs-crane" value="yes" onclick="toggleCraneDetails(true)"> بله</label>
                                <label><input type="radio" name="needs-crane" value="no" checked onclick="toggleCraneDetails(false)"> خیر</label>
                            </div>
                        </div>
                        <div id="crane-details-section" class="hidden">
                            <div class="form-group">
                                <label for="crane-tonnage">تناژ جرثقیل (تن)</label>
                                <input type="number" id="crane-tonnage" class="form-control" min="1" step="0.5">
                            </div>
                        </div>
                    </div>
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-paint-roller"></i> سندبلاست و رنگ</h3>
                        <div class="form-group">
                            <label>آیا به سندبلاست نیاز دارید؟</label>
                            <div style="display: flex; gap: 1.5rem;">
                                <label><input type="radio" name="sandblast" value="yes"> بله</label>
                                <label><input type="radio" name="sandblast" value="no" checked> خیر</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="paint-type">نوع رنگ</label>
                            <select id="paint-type" class="form-control" onchange="toggleOtherPaintType()">
                                <option value="">انتخاب کنید</option>
                                <option value="ضد زنگ">ضد زنگ</option>
                                <option value="آلکیدی">آلکیدی</option>
                                <option value="زینک ریچ">زینک ریچ</option>
                                <option value="اپوکسی">اپوکسی</option>
                                <option value="other">سایر</option>
                            </select>
                            <input type="text" id="other-paint-type" class="form-control hidden" placeholder="نوع رنگ" style="margin-top: 10px;">
                        </div>
                        <div class="form-group">
                            <label for="paint-thickness">ضخامت رنگ (میکرون)</label>
                            <input type="number" id="paint-thickness" class="form-control" value="50" min="20" max="200">
                        </div>
                    </div>
                    <div style="background: white; border-radius: 10px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-tasks"></i> مسئولیت‌های خریدار</h3>
                        <div style="display: flex; gap: 1.5rem;">
                            <label><input type="checkbox" name="responsibility" value="steel"> تهیه آهن آلات</label>
                            <label><input type="checkbox" name="responsibility" value="bolts"> تهیه پیچ و مهره</label>
                            <label><input type="checkbox" name="responsibility" value="transport"> حمل</label>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                        <button type="button" class="btn btn-secondary" onclick="showPage('shed')">بازگشت</button>
                        <button type="submit" class="btn btn-primary">ارسال درخواست</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <section id="terms-page" class="page hidden">
        <div class="container" style="max-width: 900px; margin: 0 auto; padding: 3rem 0;">
            <div style="background: white; border-radius: 10px; padding: 2.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h1 class="section-title">قوانین و شرایط استفاده از B2BSteel</h1>
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary);">۱. مقدمه و کلیات</h3>
                    <p>پلتفرم B2BSteel یک بازارگاه آنلاین برای ارتباط مستقیم بین خریداران و فروشندگان قالب‌های فلزی بتن و سوله است. این پلتفرم صرفاً به عنوان واسط فناوری عمل کرده و نقش آن محدود به نمایش درخواست‌ها و پیشنهادات است.</p>
                </div>
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary);">۲. مسئولیت پلتفرم</h3>
                    <p>پلتفرم هیچ‌گونه مسئولیتی در قبال کیفیت کالاها، تحویل به موقع، تطابق کالا با مشخصات درخواستی، یا انجام تعهدات مالی خریداران و فروشندگان ندارد.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="guide-page" class="page hidden">
        <div class="container" style="padding: 4rem 0;">
            <h2 class="section-title">راهنمای استفاده از B2BSteel</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <div style="background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                    <div style="width: 50px; height: 50px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-weight: bold; font-size: 1.5rem;">۱</div>
                    <h3 style="color: var(--primary);">ثبت‌نام</h3>
                    <p>به عنوان خریدار یا فروشنده ثبت‌نام کنید.</p>
                </div>
                <div style="background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                    <div style="width: 50px; height: 50px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-weight: bold; font-size: 1.5rem;">۲</div>
                    <h3 style="color: var(--primary);">ایجاد درخواست</h3>
                    <p>خریداران درخواست خود را ثبت می‌کنند.</p>
                </div>
                <div style="background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center;">
                    <div style="width: 50px; height: 50px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-weight: bold; font-size: 1.5rem;">۳</div>
                    <h3 style="color: var(--primary);">دریافت پیشنهاد</h3>
                    <p>فروشندگان پیشنهادات خود را ارسال می‌کنند.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="blog-page" class="page hidden">
        <div class="container" style="padding: 4rem 0;">
            <h2 class="section-title">مقالات و اخبار</h2>
            <div class="blog-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                <div class="blog-card" style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <div style="width: 100%; height: 250px; background: linear-gradient(135deg, var(--primary-dark), var(--primary)); display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-cubes" style="font-size: 4rem;"></i>
                    </div>
                    <div class="blog-content" style="padding: 1.5rem;">
                        <h3 class="blog-title" style="color: var(--primary);">انواع قالب فلزی بتن</h3>
                        <div class="blog-date" style="color: var(--muted);">۱۴۰۲/۱۲/۱۵</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="register-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">ثبت‌نام در B2BSteel</h2>
                <div class="user-type-selector" id="user-type-main-selector">
                    <div class="user-type-btn active" data-type="buyer" onclick="selectUserType('buyer')">خریدار</div>
                    <div class="user-type-btn" data-type="seller" onclick="selectUserType('seller')">فروشنده</div>
                </div>
                <div class="form-group">
                    <label>نوع کاربر</label>
                    <div class="user-type-selector" id="user-legal-type-selector">
                        <div class="user-type-btn" data-type="individual" onclick="selectUserLegalType('individual')">شخص حقیقی</div>
                        <div class="user-type-btn active" data-type="company" onclick="selectUserLegalType('company')">شرکت/حقوقی</div>
                    </div>
                </div>
                <div id="seller-type-section" class="form-group hidden">
                    <label>نوع فروشنده</label>
                    <div class="user-type-selector" id="seller-type-selector">
                        <div class="user-type-btn active" data-type="formwork" onclick="selectSellerType('formwork')">قالب</div>
                        <div class="user-type-btn" data-type="shed" onclick="selectSellerType('shed')">سوله</div>
                    </div>
                </div>
                <form id="register-form">
                    <div class="form-group">
                        <label for="reg-email">ایمیل</label>
                        <input type="email" id="reg-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">رمز عبور</label>
                        <input type="password" id="reg-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password-confirm">تکرار رمز عبور</label>
                        <input type="password" id="reg-password-confirm" class="form-control" required>
                        <div id="password-match-error" style="color: red; font-size: 0.85rem;"></div>
                    </div>
                    <div id="company-fields">
                        <div class="form-group">
                            <label for="reg-company" id="company-label">نام شرکت</label>
                            <input type="text" id="reg-company" class="form-control" placeholder="اختیاری">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reg-contact">نام شخص رابط</label>
                        <input type="text" id="reg-contact" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-phone">تلفن تماس</label>
                        <input type="tel" id="reg-phone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="accept-terms" required>
                            <a href="#" onclick="showPage('terms'); return false;">قوانین</a> را می‌پذیرم.
                        </label>
                    </div>
                    <div id="register-error" style="color: red; margin-bottom: 1rem;"></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">ثبت‌نام</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">قبلاً حساب دارید؟ <a href="#" onclick="showPage('login')">وارد شوید</a></p>
            </div>
        </div>
    </section>

    <section id="login-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">ورود به حساب کاربری</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">ایمیل</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">رمز عبور</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <div id="login-error" style="color: red; margin-bottom: 1rem;"></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">ورود</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">حساب ندارید؟ <a href="#" onclick="showPage('register')">ثبت‌نام کنید</a></p>
            </div>
        </div>
    </section>

    <section id="forgot-password-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">بازیابی رمز عبور</h2>
                <form id="forgot-password-form">
                    <div class="form-group">
                        <label for="reset-email">ایمیل خود را وارد کنید</label>
                        <input type="email" id="reset-email" class="form-control" required>
                    </div>
                    <div id="reset-message" style="color: green; text-align: center;"></div>
                    <div id="reset-error" style="color: red; text-align: center;"></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ارسال لینک بازیابی</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;"><a href="#" onclick="showPage('login')">بازگشت به ورود</a></p>
            </div>
        </div>
    </section>

    <section id="dashboard-page" class="page hidden">
        <div class="container dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">?</div>
                    <div>
                        <h2 id="user-name">کاربر عزیز</h2>
                        <p id="user-type">نوع حساب: در حال بارگذاری...</p>
                    </div>
                </div>
                <div id="buyer-actions">
                    <button class="btn btn-primary" onclick="showNewConcreteRequestModal()">
                        <i class="fas fa-plus"></i> درخواست قالب جدید
                    </button>
                    <button class="btn btn-success" onclick="showNewShedRequestModal()">
                        <i class="fas fa-plus"></i> درخواست سوله جدید
                    </button>
                </div>
            </div>
            <div class="stats-grid" id="dashboard-stats"></div>
            <div class="dashboard-actions">
                <button class="btn btn-secondary" onclick="loadBuyerConcreteRequests()">درخواست‌های قالب</button>
                <button class="btn btn-secondary" onclick="loadBuyerShedRequests()">درخواست‌های سوله</button>
            </div>
            <div id="dashboard-content">
                <div class="requests-list">
                    <div class="request-item"><p style="text-align: center; color: var(--muted);">گزینه‌ای انتخاب کنید</p></div>
                </div>
            </div>
        </div>
    </section>

    <section id="seller-formwork-dashboard-page" class="page hidden">
        <div class="container dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <div class="user-avatar" id="seller-formwork-avatar">🏗️</div>
                    <div>
                        <h2>داشبورد فروشنده قالب</h2>
                        <p id="seller-formwork-name">در حال بارگذاری...</p>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="logout()">خروج</button>
            </div>
            <div class="stats-grid" id="seller-formwork-stats"></div>
            <div class="dashboard-actions">
                <button class="btn btn-secondary" onclick="loadFormworkSellerOpenRequests()">درخواست‌های باز قالب</button>
                <button class="btn btn-secondary" onclick="loadFormworkSellerBids()">پیشنهادهای من</button>
            </div>
            <div id="seller-formwork-dashboard-content">
                <div class="requests-list">
                    <div class="request-item"><p style="text-align: center; color: var(--muted);">گزینه‌ای انتخاب کنید</p></div>
                </div>
            </div>
        </div>
    </section>

    <section id="seller-shed-dashboard-page" class="page hidden">
        <div class="container dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <div class="user-avatar" id="seller-shed-avatar">🏭</div>
                    <div>
                        <h2>داشبورد فروشنده سوله</h2>
                        <p id="seller-shed-name">در حال بارگذاری...</p>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="logout()">خروج</button>
            </div>
            <div class="stats-grid" id="seller-shed-stats"></div>
            <div class="dashboard-actions">
                <button class="btn btn-secondary" onclick="loadShedSellerOpenRequests()">درخواست‌های باز سوله</button>
                <button class="btn btn-secondary" onclick="loadShedSellerBids()">پیشنهادهای من</button>
            </div>
            <div id="seller-shed-dashboard-content">
                <div class="requests-list">
                    <div class="request-item"><p style="text-align: center; color: var(--muted);">گزینه‌ای انتخاب کنید</p></div>
                </div>
            </div>
        </div>
    </section>

    <section id="admin-page" class="page hidden">
        <div class="container admin-panel">
            <h2 class="section-title">پنل مدیریت ادمین</h2>
            <div class="admin-stats">
                <div class="admin-stat-card">
                    <h3>کل کاربران</h3>
                    <div class="value" id="admin-total-users">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>خریداران</h3>
                    <div class="value" id="admin-total-buyers">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>فروشندگان قالب</h3>
                    <div class="value" id="admin-formwork-sellers">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>فروشندگان سوله</h3>
                    <div class="value" id="admin-shed-sellers">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>درخواست‌های قالب</h3>
                    <div class="value" id="admin-concrete-requests">۰</div>
                </div>
                <div class="admin-stat-card">
                    <h3>درخواست‌های سوله</h3>
                    <div class="value" id="admin-shed-requests">۰</div>
                </div>
            </div>
            <div class="admin-actions">
                <button class="btn btn-primary" onclick="loadAllUsers()">مدیریت کاربران</button>
                <button class="btn btn-primary" onclick="loadAllConcreteRequests()">همه درخواست‌های قالب</button>
                <button class="btn btn-primary" onclick="loadAllShedRequestsAdmin()">همه درخواست‌های سوله</button>
                <button class="btn btn-primary" onclick="loadAllTransactionsAdmin()">تراکنش‌ها</button>
            </div>
            <div id="admin-content">
                <div class="requests-list">
                    <div class="request-item"><p style="text-align: center; color: var(--muted);">گزینه‌ای انتخاب کنید</p></div>
                </div>
            </div>
        </div>
    </section>
</main>

<div id="new-concrete-request-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>درخواست قالب جدید</h3>
            <button class="close-modal" onclick="closeModal('new-concrete-request-modal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="new-concrete-request-form">
                <div class="form-group">
                    <label for="concrete-title">عنوان</label>
                    <input type="text" id="concrete-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="concrete-description">توضیحات</label>
                    <textarea id="concrete-description" class="form-control" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="concrete-location">محل پروژه</label>
                    <input type="text" id="concrete-location" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="concrete-deadline">مهلت</label>
                    <input type="date" id="concrete-deadline" class="form-control" required>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('new-concrete-request-modal')">انصراف</button>
            <button class="btn btn-primary" onclick="submitNewConcreteRequest()">ثبت</button>
        </div>
    </div>
</div>

<div id="new-shed-request-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>درخواست سوله جدید</h3>
            <button class="close-modal" onclick="closeModal('new-shed-request-modal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="new-shed-request-form">
                <div class="form-group">
                    <label for="shed-req-length">طول (متر)</label>
                    <input type="number" id="shed-req-length" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="shed-req-width">عرض (متر)</label>
                    <input type="number" id="shed-req-width" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="shed-req-height">ارتفاع (متر)</label>
                    <input type="number" id="shed-req-height" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="shed-req-usage">کارکرد</label>
                    <textarea id="shed-req-usage" class="form-control" rows="2" required></textarea>
                </div>
                <div class="form-group">
                    <label for="shed-req-location">محل نصب</label>
                    <input type="text" id="shed-req-location" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>جرثقیل</label>
                    <div><label><input type="radio" name="shed-req-crane" value="yes" onclick="toggleShedCraneDetails(true)"> بله</label> <label><input type="radio" name="shed-req-crane" value="no" checked onclick="toggleShedCraneDetails(false)"> خیر</label></div>
                </div>
                <div id="shed-req-crane-details" class="hidden">
                    <div class="form-group">
                        <label for="shed-req-crane-tonnage">تناژ (تن)</label>
                        <input type="number" id="shed-req-crane-tonnage" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="shed-req-deadline">مهلت</label>
                    <input type="date" id="shed-req-deadline" class="form-control" required>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('new-shed-request-modal')">انصراف</button>
            <button class="btn btn-primary" onclick="submitNewShedRequest()">ثبت</button>
        </div>
    </div>
</div>

<div id="submit-bid-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ارسال پیشنهاد قیمت</h3>
            <button class="close-modal" onclick="closeModal('submit-bid-modal')">&times;</button>
        </div>
        <div class="modal-body">
            <div id="bid-project-info" style="background: #eff6ff; padding: 10px; border-radius: 6px; margin-bottom: 20px;"></div>
            <form id="submit-bid-form">
                <input type="hidden" id="bid-request-id">
                <input type="hidden" id="bid-request-type">
                <div class="form-group">
                    <label for="bid-price">قیمت پیشنهادی (ریال)</label>
                    <input type="text" id="bid-price" class="form-control" required oninput="formatPriceInput(this)">
                </div>
                <div class="form-group">
                    <label for="bid-delivery">زمان تحویل (روز)</label>
                    <input type="number" id="bid-delivery" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="bid-warranty">گارانتی (ماه)</label>
                    <input type="number" id="bid-warranty" class="form-control" value="12">
                </div>
                <div class="form-group">
                    <label for="bid-notes">توضیحات</label>
                    <textarea id="bid-notes" class="form-control" rows="3"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('submit-bid-modal')">انصراف</button>
            <button class="btn btn-primary" onclick="submitBid()">ارسال</button>
        </div>
    </div>
</div>

<div id="edit-bid-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ویرایش پیشنهاد</h3>
            <button class="close-modal" onclick="closeModal('edit-bid-modal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="edit-bid-form">
                <input type="hidden" id="edit-bid-id">
                <div class="form-group">
                    <label for="edit-bid-price">قیمت (ریال)</label>
                    <input type="text" id="edit-bid-price" class="form-control" required oninput="formatPriceInput(this)">
                </div>
                <div class="form-group">
                    <label for="edit-bid-delivery">زمان تحویل (روز)</label>
                    <input type="number" id="edit-bid-delivery" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="edit-bid-warranty">گارانتی (ماه)</label>
                    <input type="number" id="edit-bid-warranty" class="form-control">
                </div>
                <div class="form-group">
                    <label for="edit-bid-notes">توضیحات</label>
                    <textarea id="edit-bid-notes" class="form-control" rows="3"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('edit-bid-modal')">انصراف</button>
            <button class="btn btn-primary" onclick="updateBid()">ثبت تغییرات</button>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3>B2BSteel</h3>
                <p>پلتفرم تخصصی قالب فلزی بتن و سوله</p>
            </div>
            <div class="footer-section">
                <h3>لینک‌ها</h3>
                <ul style="list-style: none;">
                    <li><a href="#" onclick="showPage('home')">خانه</a></li>
                    <li><a href="#" onclick="showPage('concrete-formwork')">قالب بتن</a></li>
                    <li><a href="#" onclick="showPage('shed')">سوله</a></li>
                    <li><a href="#" onclick="showPage('terms')">قوانین</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom"><p>© ۱۴۰۴ B2BSteel</p></div>
    </div>
</footer>

<script type="importmap">
    { "imports": { "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2" } }
</script>
<script type="module" src="supabaseClient.js"></script>
<script type="module">
    import { supabase } from './supabaseClient.js';
    window.supabase = supabase;

    // ========== متغیرهای سراسری ==========
    let currentUser = JSON.parse(localStorage.getItem('current_user')) || null;
    window.currentUser = currentUser;

    let selectedUserType = 'buyer';
    let selectedUserLegalType = 'company';
    let selectedSellerType = 'formwork';

    // ========== نمایش صفحات ==========
    window.showPage = function(pageId) {
        document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        const target = document.getElementById(pageId + '-page');
        if (target) target.classList.remove('hidden');
        updateNavigation();
        if (pageId === 'dashboard' && currentUser?.userType === 'buyer') loadBuyerDashboard();
        else if (pageId === 'seller-formwork-dashboard' && currentUser?.userType === 'seller' && currentUser?.sellerType === 'formwork') loadFormworkSellerDashboard();
        else if (pageId === 'seller-shed-dashboard' && currentUser?.userType === 'seller' && currentUser?.sellerType === 'shed') loadShedSellerDashboard();
        else if (pageId === 'admin' && currentUser?.isAdmin) loadAdminPanel();
        else if (pageId === 'home') { loadCounters(); initImageSlider(); }
    };

    window.updateNavigation = function() {
        const auth = document.getElementById('auth-buttons');
        const user = document.getElementById('user-menu');
        const sf = document.getElementById('seller-formwork-menu');
        const ss = document.getElementById('seller-shed-menu');
        const admin = document.getElementById('admin-menu');
        if (!auth) return;
        if (currentUser) {
            auth.classList.add('hidden');
            if (currentUser.isAdmin) {
                admin?.classList.remove('hidden');
                user?.classList.add('hidden');
                sf?.classList.add('hidden');
                ss?.classList.add('hidden');
            } else if (currentUser.userType === 'buyer') {
                user?.classList.remove('hidden');
                admin?.classList.add('hidden');
                sf?.classList.add('hidden');
                ss?.classList.add('hidden');
            } else if (currentUser.userType === 'seller' && currentUser.sellerType === 'formwork') {
                sf?.classList.remove('hidden');
                user?.classList.add('hidden');
                admin?.classList.add('hidden');
                ss?.classList.add('hidden');
            } else if (currentUser.userType === 'seller' && currentUser.sellerType === 'shed') {
                ss?.classList.remove('hidden');
                user?.classList.add('hidden');
                admin?.classList.add('hidden');
                sf?.classList.add('hidden');
            }
        } else {
            auth.classList.remove('hidden');
            user?.classList.add('hidden');
            sf?.classList.add('hidden');
            ss?.classList.add('hidden');
            admin?.classList.add('hidden');
        }
    };

    // ========== توابع کمکی ==========
    function toEnglishNumbers(str) {
        const persian = ['۰','۱','۲','۳','۴','۵','۶','۷','۸','۹'];
        return str.toString().replace(/[۰-۹]/g, d => persian.indexOf(d).toString());
    }
    function formatPriceInput(input) {
        let val = toEnglishNumbers(input.value).replace(/[^\d]/g, '');
        if (val) input.value = parseInt(val).toLocaleString('fa-IR');
        else input.value = '';
    }
    function parsePrice(str) {
        return parseInt(toEnglishNumbers(str).replace(/[^\d]/g, '')) || 0;
    }

    // ========== احراز هویت ==========
    window.handleLogin = async function(email, password) {
        try {
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
            const { data: profile } = await supabase.from('profiles').select('*').eq('user_id', data.user.id).single();
            currentUser = {
                id: data.user.id,
                email: data.user.email,
                userType: profile?.user_type || 'buyer',
                sellerType: profile?.seller_type,
                full_name: profile?.full_name,
                isAdmin: profile?.role === 'admin' || false
            };
            localStorage.setItem('current_user', JSON.stringify(currentUser));
            window.currentUser = currentUser;
            return { success: true, user: currentUser };
        } catch (error) {
            console.error(error);
            return { success: false, error: error.message };
        }
    };

    window.handleRegister = async function(userData) {
        try {
            const { data: authData, error: authError } = await supabase.auth.signUp({
                email: userData.email,
                password: userData.password,
                options: { data: { full_name: userData.contactPerson, phone: userData.phone, user_type: userData.userType, seller_type: userData.sellerType } }
            });
            if (authError) throw authError;
            if (authData.user) {
                await supabase.from('profiles').insert([{
                    user_id: authData.user.id, email: userData.email, full_name: userData.contactPerson,
                    phone: userData.phone, user_type: userData.userType, seller_type: userData.sellerType,
                    verification_status: 'pending', role: 'user'
                }]);
                currentUser = { id: authData.user.id, email: userData.email, userType: userData.userType, sellerType: userData.sellerType, full_name: userData.contactPerson, isAdmin: false };
                localStorage.setItem('current_user', JSON.stringify(currentUser));
                window.currentUser = currentUser;
            }
            return { success: true, user: currentUser };
        } catch (error) {
            console.error(error);
            return { success: false, error: error.message };
        }
    };

    window.logout = async function() {
        await supabase.auth.signOut();
        currentUser = null;
        localStorage.removeItem('current_user');
        window.currentUser = null;
        showPage('home');
        alert('خروج موفق');
    };

    // ========== انتخاب نوع کاربر ==========
    window.selectUserType = function(type) {
        selectedUserType = type;
        const main = document.getElementById('user-type-main-selector');
        if (main) main.querySelectorAll('.user-type-btn').forEach(b => b.classList.toggle('active', b.dataset.type === type));
        const sellerSec = document.getElementById('seller-type-section');
        if (sellerSec) sellerSec.classList.toggle('hidden', type !== 'seller');
    };
    window.selectUserLegalType = function(type) {
        selectedUserLegalType = type;
        const legal = document.getElementById('user-legal-type-selector');
        if (legal) legal.querySelectorAll('.user-type-btn').forEach(b => b.classList.toggle('active', b.dataset.type === type));
        const company = document.getElementById('company-fields');
        if (company) company.style.display = type === 'company' ? 'block' : 'none';
    };
    window.selectSellerType = function(type) {
        selectedSellerType = type;
        const seller = document.getElementById('seller-type-selector');
        if (seller) seller.querySelectorAll('.user-type-btn').forEach(b => b.classList.toggle('active', b.dataset.type === type));
    };

    // ========== شمارنده‌ها ==========
    async function loadCounters() {
        const { count: sellers } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'seller');
        const { count: buyers } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'buyer');
        document.getElementById('counter-sellers').textContent = sellers || 0;
        document.getElementById('counter-buyers').textContent = buyers || 0;
    }

    function initImageSlider() {
        const images = document.querySelectorAll('.slider-image');
        if (!images.length) return;
        let i = 0;
        setInterval(() => {
            images[i].classList.remove('active');
            i = (i + 1) % images.length;
            images[i].classList.add('active');
        }, 5000);
    }

    // ========== داشبورد خریدار ==========
    async function loadBuyerDashboard() {
        if (!currentUser) return;
        document.getElementById('user-name').textContent = currentUser.full_name || currentUser.email;
        document.getElementById('user-avatar').textContent = (currentUser.full_name || '?').charAt(0).toUpperCase();
        const { count: concReqs } = await supabase.from('concrete_requests').select('*', { count: 'exact', head: true }).eq('user_id', currentUser.id);
        const { count: shedReqs } = await supabase.from('shed_requests').select('*', { count: 'exact', head: true }).eq('user_id', currentUser.id);
        document.getElementById('dashboard-stats').innerHTML = `
            <div class="stat-card"><h3>درخواست‌های قالب</h3><div class="value">${concReqs || 0}</div></div>
            <div class="stat-card"><h3>درخواست‌های سوله</h3><div class="value">${shedReqs || 0}</div></div>
        `;
    }

    window.loadBuyerConcreteRequests = async function() {
        if (!currentUser) return;
        const { data: requests } = await supabase.from('concrete_requests').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
        const container = document.getElementById('dashboard-content');
        if (!requests || requests.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">درخواستی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        requests.forEach(r => {
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">${r.title || 'بدون عنوان'}</span><span class="request-badge badge-open">${r.status || 'باز'}</span></div>
                <div class="request-details"><div>${r.description || ''}</div><div>${r.project_location || ''}</div></div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    };

    window.loadBuyerShedRequests = async function() {
        if (!currentUser) return;
        const { data: requests } = await supabase.from('shed_requests').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
        const container = document.getElementById('dashboard-content');
        if (!requests || requests.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">درخواستی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        requests.forEach(r => {
            const dims = r.dimensions || {};
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">سوله ${dims.length || '?'}×${dims.width || '?'}</span><span class="request-badge badge-open">${r.status || 'باز'}</span></div>
                <div class="request-details"><div>${r.usage || ''}</div><div>${r.location || ''}</div></div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    };

    window.showNewConcreteRequestModal = function() { document.getElementById('new-concrete-request-modal').classList.add('active'); };
    window.showNewShedRequestModal = function() { document.getElementById('new-shed-request-modal').classList.add('active'); };

    window.submitNewConcreteRequest = async function() {
        if (!currentUser) return;
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return alert('خطا');
        const title = document.getElementById('concrete-title').value;
        const desc = document.getElementById('concrete-description').value;
        const loc = document.getElementById('concrete-location').value;
        const deadline = document.getElementById('concrete-deadline').value;
        if (!title || !desc || !loc || !deadline) return alert('همه فیلدها را پر کنید');
        const { error } = await supabase.from('concrete_requests').insert([{
            user_id: user.id, title, description: desc, project_location: loc, deadline, status: 'open'
        }]);
        if (error) alert(error.message); else { alert('ثبت شد'); closeModal('new-concrete-request-modal'); loadBuyerConcreteRequests(); }
    };

    window.submitNewShedRequest = async function() {
        if (!currentUser) return;
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return alert('خطا');
        const dims = {
            length: parseFloat(document.getElementById('shed-req-length').value),
            width: parseFloat(document.getElementById('shed-req-width').value),
            height: parseFloat(document.getElementById('shed-req-height').value)
        };
        const usage = document.getElementById('shed-req-usage').value;
        const location = document.getElementById('shed-req-location').value;
        const deadline = document.getElementById('shed-req-deadline').value;
        const needsCrane = document.querySelector('input[name="shed-req-crane"]:checked').value === 'yes';
        const craneTonnage = needsCrane ? parseFloat(document.getElementById('shed-req-crane-tonnage').value) : null;
        if (!dims.length || !dims.width || !dims.height || !usage || !location || !deadline) return alert('همه فیلدها را پر کنید');
        const { error } = await supabase.from('shed_requests').insert([{
            user_id: user.id, dimensions: dims, usage, location, deadline, needs_crane: needsCrane, crane_tonnage: craneTonnage, status: 'open'
        }]);
        if (error) alert(error.message); else { alert('ثبت شد'); closeModal('new-shed-request-modal'); loadBuyerShedRequests(); }
    };

    // ========== داشبورد فروشنده قالب ==========
    window.loadFormworkSellerDashboard = async function() {
        if (!currentUser) return;
        document.getElementById('seller-formwork-name').textContent = currentUser.full_name || currentUser.email;
    };
    window.loadFormworkSellerOpenRequests = async function() {
        const { data: requests } = await supabase.from('concrete_requests').select('*').eq('status', 'open').order('created_at', { ascending: false });
        const container = document.getElementById('seller-formwork-dashboard-content');
        if (!requests || requests.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">درخواستی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        for (const r of requests) {
            const { data: bids } = await supabase.from('bids').select('*').eq('request_id', r.id).eq('seller_id', currentUser.id);
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">${r.title || 'بدون عنوان'}</span><span class="request-badge badge-open">باز</span></div>
                <div class="request-details"><div>${r.description || ''}</div><div>${r.project_location || ''}</div></div>
                <div class="request-actions">`;
            if (!bids || bids.length === 0) html += `<button class="btn btn-primary btn-sm" onclick="openBidModal('concrete', ${r.id}, '${r.title}')">ارسال پیشنهاد</button>`;
            else html += `<button class="btn btn-secondary btn-sm" disabled>پیشنهاد داده‌اید</button><button class="btn btn-warning btn-sm" onclick="editBid('${bids[0].id}')">ویرایش</button>`;
            html += `</div></div>`;
        }
        html += '</div>';
        container.innerHTML = html;
    };
    window.loadFormworkSellerBids = async function() {
        const { data: bids } = await supabase.from('bids').select('*, concrete_requests(*)').eq('seller_id', currentUser.id).order('created_at', { ascending: false });
        const container = document.getElementById('seller-formwork-dashboard-content');
        if (!bids || bids.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">پیشنهادی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        bids.forEach(b => {
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">${b.concrete_requests?.title || 'بدون عنوان'}</span><span class="request-badge badge-info">${b.status || 'ارسال‌شده'}</span></div>
                <div class="request-details"><div>قیمت: ${(b.price || 0).toLocaleString('fa-IR')} ریال</div><div>زمان تحویل: ${b.delivery_days || '?'} روز</div></div>
                <div class="request-actions"><button class="btn btn-warning btn-sm" onclick="editBid('${b.id}')">ویرایش</button></div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    };

    // ========== داشبورد فروشنده سوله ==========
    window.loadShedSellerDashboard = async function() {
        if (!currentUser) return;
        document.getElementById('seller-shed-name').textContent = currentUser.full_name || currentUser.email;
    };
    window.loadShedSellerOpenRequests = async function() {
        const { data: requests } = await supabase.from('shed_requests').select('*').eq('status', 'open').order('created_at', { ascending: false });
        const container = document.getElementById('seller-shed-dashboard-content');
        if (!requests || requests.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">درخواستی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        for (const r of requests) {
            const { data: bids } = await supabase.from('shed_bids').select('*').eq('request_id', r.id).eq('seller_id', currentUser.id);
            const dims = r.dimensions || {};
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">سوله ${dims.length || '?'}×${dims.width || '?'}</span><span class="request-badge badge-open">باز</span></div>
                <div class="request-details"><div>${r.usage || ''}</div><div>${r.location || ''}</div></div>
                <div class="request-actions">`;
            if (!bids || bids.length === 0) html += `<button class="btn btn-primary btn-sm" onclick="openBidModal('shed', ${r.id}, 'سوله ${dims.length || '?'}×${dims.width || '?'}')">ارسال پیشنهاد</button>`;
            else html += `<button class="btn btn-secondary btn-sm" disabled>پیشنهاد داده‌اید</button><button class="btn btn-warning btn-sm" onclick="editShedBid('${bids[0].id}')">ویرایش</button>`;
            html += `</div></div>`;
        }
        html += '</div>';
        container.innerHTML = html;
    };
    window.loadShedSellerBids = async function() {
        const { data: bids } = await supabase.from('shed_bids').select('*, shed_requests(*)').eq('seller_id', currentUser.id).order('created_at', { ascending: false });
        const container = document.getElementById('seller-shed-dashboard-content');
        if (!bids || bids.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">پیشنهادی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        bids.forEach(b => {
            const dims = b.shed_requests?.dimensions || {};
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">سوله ${dims.length || '?'}×${dims.width || '?'}</span><span class="request-badge badge-info">${b.status || 'ارسال‌شده'}</span></div>
                <div class="request-details"><div>قیمت: ${(b.price || 0).toLocaleString('fa-IR')} ریال</div><div>تحویل: ${b.delivery_days || '?'} روز</div></div>
                <div class="request-actions"><button class="btn btn-warning btn-sm" onclick="editShedBid('${b.id}')">ویرایش</button></div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    };

    // ========== ارسال پیشنهاد ==========
    window.openBidModal = function(type, requestId, title) {
        document.getElementById('bid-request-id').value = requestId;
        document.getElementById('bid-request-type').value = type;
        document.getElementById('bid-project-info').innerHTML = `<strong>پروژه:</strong> ${title}`;
        document.getElementById('submit-bid-modal').classList.add('active');
    };
    window.submitBid = async function() {
        const requestId = document.getElementById('bid-request-id').value;
        const type = document.getElementById('bid-request-type').value;
        const price = parsePrice(document.getElementById('bid-price').value);
        const delivery = parseInt(document.getElementById('bid-delivery').value);
        const warranty = parseInt(document.getElementById('bid-warranty').value) || 0;
        const notes = document.getElementById('bid-notes').value;
        if (!price || !delivery) return alert('قیمت و زمان تحویل را وارد کنید');
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) return alert('خطا');
        let error;
        if (type === 'concrete') {
            ({ error } = await supabase.from('bids').insert([{
                request_id: requestId, seller_id: user.id, price, delivery_days: delivery, warranty_months: warranty, notes, status: 'submitted'
            }]));
        } else {
            ({ error } = await supabase.from('shed_bids').insert([{
                request_id: requestId, seller_id: user.id, price, delivery_days: delivery, warranty_months: warranty, notes, status: 'submitted'
            }]));
        }
        if (error) alert(error.message); else { alert('پیشنهاد ارسال شد'); closeModal('submit-bid-modal'); }
    };

    // ========== ویرایش پیشنهاد ==========
    window.editBid = async function(bidId) {
        const { data: bid } = await supabase.from('bids').select('*').eq('id', bidId).single();
        if (!bid) return;
        document.getElementById('edit-bid-id').value = bid.id;
        document.getElementById('edit-bid-price').value = bid.price.toLocaleString('fa-IR');
        document.getElementById('edit-bid-delivery').value = bid.delivery_days;
        document.getElementById('edit-bid-warranty').value = bid.warranty_months;
        document.getElementById('edit-bid-notes').value = bid.notes || '';
        document.getElementById('edit-bid-modal').classList.add('active');
    };
    window.updateBid = async function() {
        const id = document.getElementById('edit-bid-id').value;
        const price = parsePrice(document.getElementById('edit-bid-price').value);
        const delivery = parseInt(document.getElementById('edit-bid-delivery').value);
        const warranty = parseInt(document.getElementById('edit-bid-warranty').value) || 0;
        const notes = document.getElementById('edit-bid-notes').value;
        const { error } = await supabase.from('bids').update({ price, delivery_days: delivery, warranty_months: warranty, notes }).eq('id', id);
        if (error) alert(error.message); else { alert('ویرایش شد'); closeModal('edit-bid-modal'); loadFormworkSellerBids(); }
    };

    // ========== پنل ادمین ==========
    window.loadAdminPanel = async function() {
        const { count: total } = await supabase.from('profiles').select('*', { count: 'exact', head: true });
        const { count: buyers } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'buyer');
        const { count: formwork } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'seller').eq('seller_type', 'formwork');
        const { count: shedSellers } = await supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('user_type', 'seller').eq('seller_type', 'shed');
        const { count: concReqs } = await supabase.from('concrete_requests').select('*', { count: 'exact', head: true });
        const { count: shedReqs } = await supabase.from('shed_requests').select('*', { count: 'exact', head: true });
        document.getElementById('admin-total-users').textContent = total || 0;
        document.getElementById('admin-total-buyers').textContent = buyers || 0;
        document.getElementById('admin-formwork-sellers').textContent = formwork || 0;
        document.getElementById('admin-shed-sellers').textContent = shedSellers || 0;
        document.getElementById('admin-concrete-requests').textContent = concReqs || 0;
        document.getElementById('admin-shed-requests').textContent = shedReqs || 0;
    };
    window.loadAllUsers = async function() {
        const { data: users } = await supabase.from('profiles').select('*').order('created_at', { ascending: false });
        const container = document.getElementById('admin-content');
        if (!users || users.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">کاربری نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        users.forEach(u => {
            let type = 'کاربر';
            if (u.role === 'admin') type = 'ادمین';
            else if (u.user_type === 'buyer') type = 'خریدار';
            else if (u.user_type === 'seller') type = u.seller_type === 'formwork' ? 'فروشنده قالب' : 'فروشنده سوله';
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">${u.full_name || 'بدون نام'}</span><span class="request-badge badge-info">${type}</span></div>
                <div class="request-details"><div>${u.email}</div><div>${u.phone || ''}</div></div>
                <div class="request-actions"><button class="btn btn-danger btn-sm" onclick="alert('حذف کاربر در حال توسعه')">حذف</button></div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    };
    window.loadAllConcreteRequests = async function() {
        const { data: requests } = await supabase.from('concrete_requests').select('*, profiles(full_name, email)').order('created_at', { ascending: false });
        const container = document.getElementById('admin-content');
        if (!requests || requests.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">درخواستی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        requests.forEach(r => {
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">${r.title || 'بدون عنوان'}</span><span class="request-badge badge-open">${r.status || 'باز'}</span></div>
                <div class="request-details"><div>${r.description || ''}</div><div>خریدار: ${r.profiles?.full_name || r.profiles?.email || '?'}</div></div>
                <div class="request-actions"><button class="btn btn-danger btn-sm" onclick="alert('حذف در حال توسعه')">حذف</button></div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    };
    window.loadAllShedRequestsAdmin = async function() {
        const { data: requests } = await supabase.from('shed_requests').select('*, profiles(full_name, email)').order('created_at', { ascending: false });
        const container = document.getElementById('admin-content');
        if (!requests || requests.length === 0) {
            container.innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">درخواستی نیست</p></div></div>';
            return;
        }
        let html = '<div class="requests-list">';
        requests.forEach(r => {
            const dims = r.dimensions || {};
            html += `<div class="request-item">
                <div class="request-header"><span class="request-title">سوله ${dims.length || '?'}×${dims.width || '?'}</span><span class="request-badge badge-open">${r.status || 'باز'}</span></div>
                <div class="request-details"><div>${r.usage || ''}</div><div>خریدار: ${r.profiles?.full_name || r.profiles?.email || '?'}</div></div>
                <div class="request-actions"><button class="btn btn-danger btn-sm" onclick="alert('حذف در حال توسعه')">حذف</button></div>
            </div>`;
        });
        html += '</div>';
        container.innerHTML = html;
    };
    window.loadAllTransactionsAdmin = async function() {
        document.getElementById('admin-content').innerHTML = '<div class="requests-list"><div class="request-item"><p style="text-align: center;">ماژول تراکنش در حال توسعه</p></div></div>';
    };

    // ========== توابع عمومی ==========
    window.closeModal = function(id) { document.getElementById(id).classList.remove('active'); };
    window.toggleDrawingUpload = function(show) { document.getElementById('drawing-upload-section').classList.toggle('hidden', !show); };
    window.toggleCraneDetails = function(show) { document.getElementById('crane-details-section').classList.toggle('hidden', !show); };
    window.toggleShedCraneDetails = function(show) { document.getElementById('shed-req-crane-details').classList.toggle('hidden', !show); };
    window.toggleOtherPaintType = function() {
        const pt = document.getElementById('paint-type');
        document.getElementById('other-paint-type').classList.toggle('hidden', pt.value !== 'other');
    };
    window.loadSecondhandSheds = function() {
        showPage('secondhand-shed');
        const c = document.getElementById('shed-listings');
        if (c) c.innerHTML = '<div class="shed-listing-item"><p style="text-align: center;">در حال بارگذاری آگهی‌ها...</p></div>';
    };
    window.enterConcreteFormworkSystem = function() {
        if (currentUser) {
            if (currentUser.userType === 'buyer') showPage('dashboard');
            else if (currentUser.userType === 'seller' && currentUser.sellerType === 'formwork') showPage('seller-formwork-dashboard');
            else if (currentUser.userType === 'seller' && currentUser.sellerType === 'shed') showPage('seller-shed-dashboard');
            else if (currentUser.isAdmin) showPage('admin');
        } else showPage('login');
    };

    // ========== رویدادها ==========
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('register-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!document.getElementById('accept-terms').checked) return alert('پذیرش قوانین الزامی است');
            const pwd = document.getElementById('reg-password').value;
            const conf = document.getElementById('reg-password-confirm').value;
            if (pwd !== conf) return document.getElementById('password-match-error').textContent = 'رمز مطابقت ندارد';
            const result = await handleRegister({
                email: document.getElementById('reg-email').value,
                password: pwd,
                contactPerson: document.getElementById('reg-contact').value,
                phone: document.getElementById('reg-phone').value,
                company: document.getElementById('reg-company').value,
                userType: selectedUserType,
                sellerType: selectedUserType === 'seller' ? selectedSellerType : null,
                userLegalType: selectedUserLegalType
            });
            if (result.success) {
                alert('ثبت‌نام موفق');
                if (selectedUserType === 'buyer') showPage('dashboard');
                else if (selectedUserType === 'seller' && selectedSellerType === 'formwork') showPage('seller-formwork-dashboard');
                else if (selectedUserType === 'seller' && selectedSellerType === 'shed') showPage('seller-shed-dashboard');
            } else document.getElementById('register-error').textContent = result.error;
        });

        document.getElementById('login-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const result = await handleLogin(document.getElementById('login-email').value, document.getElementById('login-password').value);
            if (result.success) {
                if (result.user.isAdmin) showPage('admin');
                else if (result.user.userType === 'buyer') showPage('dashboard');
                else if (result.user.userType === 'seller' && result.user.sellerType === 'formwork') showPage('seller-formwork-dashboard');
                else if (result.user.userType === 'seller' && result.user.sellerType === 'shed') showPage('seller-shed-dashboard');
                else showPage('home');
            } else document.getElementById('login-error').textContent = 'ایمیل یا رمز اشتباه';
        });

        document.getElementById('forgot-password-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('reset-email').value;
            const { error } = await supabase.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin });
            if (error) document.getElementById('reset-error').textContent = error.message;
            else {
                document.getElementById('reset-message').textContent = 'لینک بازیابی به ایمیل شما ارسال شد';
                document.getElementById('reset-email').value = '';
            }
        });

        document.getElementById('new-shed-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return alert('وارد شوید');
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return alert('خطا');
            const shedData = {
                user_id: user.id,
                dimensions: {
                    length: parseFloat(document.getElementById('shed-length').value),
                    width: parseFloat(document.getElementById('shed-width').value),
                    height: parseFloat(document.getElementById('shed-height').value)
                },
                usage: document.getElementById('shed-usage').value,
                location: document.getElementById('shed-location').value,
                has_drawing: document.querySelector('input[name="has-drawing"]:checked')?.value === 'yes',
                needs_crane: document.querySelector('input[name="needs-crane"]:checked')?.value === 'yes',
                crane_tonnage: document.getElementById('crane-tonnage')?.value || null,
                foundation: document.querySelector('input[name="foundation"]:checked')?.value || 'no',
                sandblast: document.querySelector('input[name="sandblast"]:checked')?.value || 'no',
                paint_type: document.getElementById('paint-type')?.value || '',
                other_paint_type: document.getElementById('other-paint-type')?.value || '',
                paint_thickness: parseInt(document.getElementById('paint-thickness')?.value) || 50,
                buyer_responsibilities: Array.from(document.querySelectorAll('input[name="responsibility"]:checked')).map(cb => cb.value),
                weight: document.getElementById('shed-weight')?.value || null,
                price_type: document.querySelector('input[name="price-type"]:checked')?.value || 'estimated',
                status: 'open'
            };
            if (!shedData.dimensions.length || !shedData.dimensions.width || !shedData.dimensions.height || !shedData.usage || !shedData.location)
                return alert('ابعاد، کارکرد و محل را وارد کنید');
            const { error } = await supabase.from('shed_requests').insert([shedData]);
            if (error) alert(error.message); else { alert('درخواست ثبت شد'); showPage('shed'); e.target.reset(); }
        });

        updateNavigation();
        showPage('home');
        loadCounters();
        initImageSlider();
    });
</script>
</body>
</html>